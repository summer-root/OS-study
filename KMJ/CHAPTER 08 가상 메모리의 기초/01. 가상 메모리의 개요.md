# 가상 메모리의 개요
## 가상 메모리 시스템
### 가상 메모리의 개념
메모리의 크기는 컴퓨터마다 다른데 운영체제가 물리 메모리의 크기에만 의존한다면 2GB의 메모리에서 동작하는 프로그램이 1GB의 메모리에서 동작하지 않을 수 있다.<br>
프로그래머 또한 메모리 크기에 맞는 운영 프로그램만 개발해야 하는데, 실제 메모리 크기를 고려하여 프로그래밍하기란 매우 어렵고 제약이 많다.<br>
<br>
현대 메모리 관리의 가장 큰 특징은 물리 메모리의 크기와 프로세스가 올라갈 메모리의 위치를 신경 쓰지 않고 프로그래밍하도록 지원한다는 것으로 이러한 메모리 시스템을 가상 메모리(virtual memory)라고 부른다.<br>
따라서 가상 메모리를 사용하면 다른 물리 메모리에서 일관되게 프로세스를 실행할 수 있다.<br>

### 가상 메모리의 크기와 주소
가상 메모리 시스템의 모든 프로세스는 물리 메모리와 별개로 자신이 메모리의 어느 위치에 있는지 상관없이 0번지부터 시작하는 연속된 메모리 공간을 가진다.<br>
이는 논리 주소와 유사하지만 논리 주소의 경우 물리 메모리의 주소 공간에 비례하고, 가상 주소는 물리 메모리 공간이 아닌 가상의 주소를 가진다는 차이점이 있다.<br>
<br>
가상메모리는 크게 프로세스가 바라보는 메모리영역과 메모리 관리자가 바라보는 메모리 영역으로 나뉜다.<br>
![](https://blog.kakaocdn.net/dn/8fRnk/btrLvI1i4NI/FmssDKIZ35SdDJrEcotqcK/img.png)<br>
이론적으로 가상메모리는 무한대의 크기이지만 실제로 가상 메모리의 최대 크기는 그 컴퓨터 시스템이 가진 물리 메모리의 최대 크기로 한정되며, CPU의 비트에 따라 결정된다.<br>
32bit CPU의 경우 32bit로 표현할 수 있는 최댓값인 2³²-1(16진수로는 FFFFFFFF), 즉 4GB가 메모리의 최대 크기이고 가상 메모리의 최대 크기도 약 4GB이다.<br>

가상 메모리가 실제로 사용할 수 있는 최대 크기의 제약이 있음에도 불구하고 무한대의 크기가 있는 것처럼 구현할 수 있는 이유는 다음과 같다.<br>
최대 크기보다 더 많은 크기의 공간을 사용하고자 할 경우에 가상메모리 시스템에서는 물리 메모리의 내용 중 일부를 하드디스크 일부 공간인 스왑 영역으로 옮긴다.<br>
스왑 영역은 하드디스크에 존재하지만 메모리 관리자가 관리하는 영역으로서 메모리의 일부이며, 가상 메모리의 구성요소 중 하나이다.<br>
메모리 관리자는 물리 메모리의 부족한 부분을 스왑영역으로 보충한다.<br>
물리 메모리가 꽉 찼을 경우에는 일부 프로세스를 스왑영역으로 보내는 스왑 아웃, 프로세스가 작업을 마치면 스왑 영역에 있는 프로세스를 메모리로 가져오는 스왑인이 이것이다. <br>

#### 동적 주소 변환(Dynamic Address Translation; TAD)
가상 메모리 시스템에서 메모리 관리자는 물리 메모리와 스왑 영역을 합쳐서 프로세스가 사용하는 가상 주소를 실제 메모리의 물리 주소로 변환한다.<br>
동적 주소 변환을 거치면 프로세스가 아무 제약 없이 사용자의 데이터를 물리 메모리에 배치할 수 있다.<br>
이 과정에서 메모리 관리자는 물리 메모리를 어떤 방법으로 나눌지, 사용자 프로세스를 어디에 배치할지, 부족한 물리 메모리를 어떻게 처리할지 등의 복잡한 문제를 처리한다.<br>

###  가상 메모리의 메모리 분할 방식
실제 메모리에 있는 물리 주소 0번지는 운영체제 영역이므로 일반 프로세스가 사용할 수 없기 때문에 가상 메모리 시스템에서는 운영체제를 제외한 나머지 메모리 영역을 일정한 크기로 나누어 일반 프로세스에 할당한다.<br>
가상 메모리 시스템에서 가변 분할 방식을 이용한 메모리 관리 기법은 세그먼테이션, 고정 분할 방식을 이용한 메모리 관리 기법은 페이징이라고 한다.<br>
이 중 세그먼테이션 기법은 가변 분할 방식의 단점인 외부 단편 화등의 문제 때문에 잘 사용되지 않으며, 페이징 기법은 페이지 관리에 어려움이 있다. <br>
따라서 가상 메모리 시스템에서는 두 기법의 단점을 보완한 세그먼테이션-페이징 혼용 기법을 주로 사용한다.<br>

#### 가상 메모리 VS 물리 메모리
| 구분 | 가상 메모리 | 물리 메모리 |
| --- | --- | --- |
| 최대 메모리 크기 | CPU의 비트값에 의존 | CPU의 비트값에 의존 |
| 메모리 분할 방식 | 세그먼테이션 | 가변 분할 방식 |
| 메모리 분할 방식 | 페이징 | 고정 분할 방식 |
| 메모리 분할 방식 || 세그먼테이션-페이징 혼용 기법 |   |
| 주소 지정 방식 | 가상 주소 | 절대 주소, 상대 주소 |

------------


## 매핑 테이블의 필요성과 역할
메모리 관리 시를 원활하게 하기 위해 매핑 테이블을 작성하여 관리한다. <br>
가상 메모리 시스템에서 가상 주소는 실제로 물리 주소나 스왑 영역 중 한 곳에 위치하며, 메모리 관리자는 가상 주소와 물리 주소를 일대일 매핑 테이블로 관리한다.<br>

#### 가상 메모리와 매핑 테이블
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbBkZm9%2FbtrLLWEtkf7%2FTUpB5tkY6OZCvbonL7IAOk%2Fimg.png)<br>
매핑 테이블에서는 가상 주소가 물리 메모리의 어느 위치에 있는지 알 수 있다. <br>
가상 주소상의 프로세스 A는 물리 메모리의 세그먼트 0에 위치하고, 프로세스 B는 세그먼트 1에 위치한다. <br>
프로세스 D의 경우에는 물리 메모리가 아니라 스왑 영역에 위치한다.<br>
프로세스 A의 어떤 값이 필요할 때는 물리 메모리의 세그먼트 0에서 원하는 데이터를 가져오면 된다.<br>
<br>
매핑 테이블은 물리 메모리가 세그먼테이션으로 분할된 경우뿐 아니라 페이징으로 분할된 경우에도 똑같은 방식으로 적용된다.<br>
페이징 기법에서 사용하는 매핑 테이블은 페이지 매핑 테이블(page mapping table) 또는 페이지 테이블이라고 부르며, 세그먼테이션 기법에서 사용하는 매핑 테이블은 세그먼테이션 매핑 테이블(segmentation mapping table) 또는 세그먼테이션 테이블이라고 부른다. <br>
