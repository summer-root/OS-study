# CPU와 메모리<br>
## CPU의 기본 구성
### 산술 논리 연산장치 (Arithmetic and Logic Unit; ALU)
CPU 내에서 데이터를 연산하는 장치<br>
데이터의 덧셈, 뺄셈, 곱셈, 나눗셈 같은 산술 연산과 AND, OR과 같은 논리 연산을 수행한다.<br>
<br>
### 제어장치 (control unit)
CPU에서 작업을 지시하는 부분을 말한다.<br>
<br>
### 레지스터 (register)
CPU 내에 데이터를 임시로 보관하는 곳을 말한다.<br>
<br>
### CPU의 명령어 처리과정
```c
int D2=2, D3=3, sum;
sum=D2+D3;
```
CPU는 0과 1의 2진수로 이루어진 기계어만 인식한다. 따라서 코드를 실행하기 위해 컴파일러를 이용해 기계어인 어셈블리어로 바꾸어야 한다.<br>
```
Load mem(100), register 2; // 메모리의 100번지(D2)에 있는 값을 레지스터2로 가져온다.
Load mem(120), register 3; // 메모리의 120번지(D3)에 있는 값을 레지스터3로 가져온다.
ADD register 8, register 2; register 3; // 레지스터 2와 레지스터 3에 저장된 값을 더한 결과를 레지스터 5에 넣는다.
MOVE register 5, mem(160); // 레지스터 5의 값을 메모리의 160번지(sum)에 넣는다.
```

- LOAD : 가져오기 명령
- ADD : 더하기 명령
- MOVE : 옮기기 명령
 
CPU는 다음의 과정으로 명령어를 처리한다.<br>

1. 필요한 데이터를 메모리에서 가져와 CPU의 레지스터에 저장
2. 산술 논리 연산장치를 이용하여 연산
3. 결괏값을 레지스터(데이터 레지스터와 주소 레지스터)에 저장
4. 결과를 다시 레지스터에 저장한 후 메모리로 옮김
 

이때, 제어장치는 명령어를 해석하여 제어 신호를 보내고 CPU의 데이터 흐름을 조절하는 역할을 한다.<br>
<br>
### 레지스터의 종류
#### 가시 레지스터 user-visible register
사용자 프로그램에 의해 변경된다.(사용자 가시 레지스터)<br>

- 데이터 레지스터 (data register; DR) : 메모리에서 가져온 데이터를 임시로 보관할 때 사용한다. CPU에 있는 대부분의 레지스터가 데이터 레지스터이기 때문에 일반 레지스터 또는 범용 레지스터라고 부른다.
- 주소 레지스터 (address register; AR) : 데이터 또는 명령어가 저장된 메모리의 주소는 주소 레지스터에 저장된다.
 

#### 특수 레지스터 user-invisible register
사용자가 임의로 변경할 수 없다.(사용자 불가시 레지스터)<br>

- 프로그램 카운터 (program counter; PC) : CPU는 다음에 어떤 명령어를 처리할지 알아야 하기 때문에 프로그램 카운터는 다음에 실행할 명령어의 주소를 기억하고 있다가 제어장치에 알려준다. 다음에 실행할 명령어의 주소를 가리키기 때문에 명령어 포인터(instruction pointer)라고도 한다.
- 명령어 레지스터 (instruction register; IR) : 현재 실행 중인 명령어를 저장한다. 제어장치는 명령어 레지스터에 있는 명령을 해석한 후 외부 장치에 적절한 제어 신호를 보낸다.
- 메모리 주소 레지스터 (memory address register; MAR) : 메모리에서 데이터를 가져오거나 반대로 메모리로 데이터를 보낼 때 주소를 지정하기 위해 사용한다. 명령어를 처리하는 과정에서 필요한 메모리 주소를 이 레지스터에 넣으면 메모리 관리자가 이를 인식하여 해당 메모리 위치의 데이터를 가져오거나 해당 메모리 위치에 데이터를 저장한다.
- 메모리 버퍼 레지스터 (memory buffer register; MBR) : 메모리에서 가져온 데이터나 메모리로 옮겨갈 데이터를 임시로 저장한다. 메모리 버퍼 레지스터는 항상 메모리 주소 레지스터와 함께 동작한다.
- 프로그램 상태 레지스터 (Program Status Register; PSR) : 산술 논리 연산장치와 연결되어있으며 연산 결과가 양수인지, 음수인지, 0이 아닌지 또는 자리올림의 유무 등을 저장한다. 플래그 레지스터, 상태 레지스터, 컨디션 레지스터라고 부르기도 한다.
 

### 버스의 종류
#### 제어 버스 control bus
다음에 어떤 작업을 할지 지시하는 제어신호가 오고 간다.<br>
Cpu의 제어장치와 연결되어있다. 제어 버스의 신호는 cpu, 메모리, 주변장치와 양방향으로 오고 간다.<br>

#### 주소 버스 address bus
메모리의 데이터를 읽거나 쓸 때 어느 위치에서 작업할 것인지 알려주는 위치정보(주소)가 오고 간다.<br>
주소 버스는 메모리 주소 레지스터와 연결되어있으며 단방향이다.<br>

#### 데이터 버스 data bus
제어 버스가 다음에 어떤 작업을 할지 신호를 보내고 주소 버스가 위치 정보를 전달하면 데이터가 데이터 버스에 실려 목적지까지 이동한다.<br>
메모리 버퍼 레지스터와 연결되어있으며 양방향이다.<br>

------------


## 메모리의 종류와 부팅
모든 프로그램은 메모리에 올라와야 실행될 수 있다.(폰 노이만 구조)<br>
### 메모리의 종류
#### 램 (Random Access Memory; RAM)
무작위로 데이터를 읽어도 저장된 위치와 상관없이 같은 속도로 데이터를 읽을 수 있다.<br>
휘발성 메모리<br>
전력이 끊기면 데이터가 사라진다.<br>

- DRAM(Dynamic RAM; 동적 램) : 저장된 0과 1의 데이터가 일정 시간이 지나면 사라지므로 일정 시간마다 다시 재생이 필요하다. 메인 메모리에 사용한다.
- SRAM(Static RAM; 정적 램) : 전력이 공급되는 동안에는 데이터를 보관할 수 있어 재생할 필요가 없다. 속도는 빠르지만 가격이 비싸다. 캐시와 같은 고속 메모리에 사용한다.
- SDRAM(Synchronous Dynamic Random Access Memory) : DRAM이 발전된 형태. 클로틱이 발생할 때마다 데이터를 저장하는 DRAM.
 

###### * DDR(Double Data Rate) SDRAM
SDRAM의 대역폭을 늘려 데이터 입출력 속도를 빠르게 한 것이다.<br>
DDR SDRAM의 대역폭은 SDRAM의 대역폭의 2배이다.<br>
대역폭이 크다는 것은 더 빨리 저장할 수 있다는 의미이다.<br>
 

#### 비휘발성 메모리 비휘발성 메모리 
플래시 메모리(flash memory) : 전력이 없어도 데이터를 보관하는 저장장치로 많이 사용(디지털카메라, MP3, USB). 플래시 메모리의 각 소자는 최대 횟수가 제하되어있어 오래 사용 시 성능이 저하되거나 데이터를 잃어버릴 수 있다.<br>
- FRAM(Ferroelectric RAM) 
- PRAM(Phase change RAM)
- SSD : 하드디스크를 대신하기 위해 만들어졌다. 가격이 비싸지만 빠른 데이터 접근 속도, 저전력, 내구성 때문에 개인용 컴퓨터는 물론 노트북, 스마트 폰과 같은 많은 기기에 사용되고 있다.
 

##### 롬 (Read Only Memory; ROM) 
전력이 끊겨도 데이터를 보관할 수 있지만 데이터를 한 번 저장하면 바꿀 수 없다. ex) CD<br>
이러한 특성 때문에 바이오스(BIOS)를 롬에 저장한다.<br>

- 마스크롬 (mask ROM) : 데이터를 지우거나 쓸 수 없다.
- PROM (Programmable ROM) : 전용기계를 이용해 데이터를 한 번만 저장할 수 있다.
- EPROM (Erasable Programmable ROM) : 데이터를 여러 번 지우고 쓸 수 있다. 플래시 메모리처럼 사용할 수 있으나 가격이 비싸서 잘 사용하지 않는다.
 

------------

## 메모리 보호
일괄 작업 시스템에서 메모리 보호는 사용자 영역의 작업이 운영체제 영역으로 침범하지 못하도록 막는 것이다.<br>
메모리가 보호되지 않으면 어떤 작업이 다른 작업의 영역을 침범하여 프로그램을 파괴하거나 데이터를 지울 수도 있으며, 최악의 경우 운영체제 영역을 침범하면 시스템이 멈출 수도 있다. 이러한 악성 소프트웨어를 바이러스라고 한다.<br>
<br>
메모리를 보호하기 위해 cpu는 현재 진행 중인 작업의 메모리 시작 주소를 경계 레지스터에 저장한 후 작업을 한다.<br>
또한, 현재 진행 중인 작업이 차지하고 있는 메모리의 크기, 즉 마지막 주소까지의 차이를 한계 레지스터에 저장한다.<br>
그리고 사용자의 작업이 진행되는 동안 이 두 레지스터의 주소 범위를 벗어나는지 하드웨어적으로 점검함으로써 메모리를 보호한다.<br>
<br>
만약 두 레지스터의 값을 벗어난다면 메모리 오류와 관련된 인터럽트가 발생되고, 인터럽트가 발생되면 모든 작업이 중단되고 cpu는 운영체제를 깨워서 인터럽트를 처리하도록 지시한다.<br>

 
### 부팅 booting
컴퓨터를 켰을때 운영체제를 메모리에 올리는 작업을 말한다.<br>

1. 사용자가 컴퓨터를 켜면 롬에 저장된 바이오스가 실행
2. 바이오스는 cpu, 메모리, 하드디스크, 키보드, 마우스와 같은 주요 하드웨어가 제대로 작동하는지 확인
3. 이상이 있을 경우 오류 메시지 출력 / 이상이 없을 경우 하드디스크의 마스터 부트 레코드(Master Boot Record; MBR)에 저장된 작은 프로그램을 메모리로 가져와 실행. 마스터 부트 레코드는 하드디스크의 첫번째 섹터를 가리키며, 운영체제를 실행하기 위한 코드인 부트스트랩 bootstrap이 저장되어있다.
4. 부트스트랩이 메모리에 올라오면 하드디스크에 저장된 운영체제를 메모리로 불러온다.
(여러 개의 운영체제 사용 시 가져온 부트스트랩을 실행하면 어떤 운영체제로 사용할 것인지 물어보는 화면이 나타남. 하나의 운영체제가 설치된 컴퓨터의 경우에는 이러한 과정 없이 바로 운영체제를 메모리에 올린다.)<br>
