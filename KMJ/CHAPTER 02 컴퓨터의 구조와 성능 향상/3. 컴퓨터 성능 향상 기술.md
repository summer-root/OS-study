# 컴퓨터 성능 향상 기술<br>
## 버퍼
### 버퍼 Buffer
속도에 차이가 있는 두 장치에서 그 차이를 완화하기 위해 일정량의 데이터를 모아 옮긴다.
같은 사양의 하드디스크라면 버퍼의 용량이 큰 것이 더 빠르다.<br>
소프트웨어적으로 사용되는 대표적인 예로는 동영상 스트리밍 streaming이 있다. 플레이어가 재생되는 도중에 데이터가 도착하지 않으면 동영상이 끊기는데, 이러한 현상을 방지하기 위해 동영상 데이터의 일정 부분을 버퍼에 넣은 후 실행한다.<br>

### 스풀 (Simultaneous Peripheral Operation On-Line; SPOOL)스풀 (Simultaneous Peripheral Operation On-Line; SPOOL)
CPU와 입력장치가 독립적으로 동작하도록 고안된 소프트웨어적인 버퍼<br>
대표적으로 프린트에 사용되는 스풀러 Spoler로, 인쇄할 내용을 하드디스크의 스풀러 공간에 저장하고 워드 프로세서는 다른 작업을 할 수 있다. <br>

### 스풀러와 버퍼의 차이점
- 버퍼 : 어떤 프로그램이 사용하는 데이터든 버퍼가 차면 이동이 시작된다. 즉, 프로그램들이 버퍼를 공유한다.
- 스풀러 : 한 인쇄물이 완료될 때까지 다른 인쇄물이 끼어들 수 없으므로 프로그램 간에 배타적이다.

###### * 하드웨어 안전 제거
버퍼를 사용하면 버퍼가 다 채워질 때까지 저장장치 간에 데이터 전송이 지연된다. 저장된 것처럼 보여도 아직 저장되지 않은 데이터가 있을 수 있으므로, 이때 하드웨어 안전 제거 기능을 이용해 버퍼에 있는 아직 옮겨지지 않은 데이터를 USB 등의 저장장치로 보내고 USB의 전원을 차단해 안전하게 제거할 수 있도록 준비해준다.<br>
유닉스의 경우 버퍼의 내용을 강제로 전송하는 명령어로 ffush를 사용한다.<br>

------------

## 캐시
### 캐시 Cache
캐시는 빠른 속도로 작동하는 CPU와 느린 속도로 작동하는 메모리 사이에서 두 장치의 속도 차이를 완화해준다.<br>
메모리의 내용 중 일부를 미리 가져오고(미리 가져오기 prefecth), CPU는 메모리에 접근해야 할 때 캐시를 먼저 방문하여 원하는 데이터가 있는지 찾아본다. <br>
캐시에서 원하는 데이터를 찾았다면 캐시 히트 cache hit라고 하며, 그 데이터를 바로 사용한다.<br>
원하는 데이터가 캐시에 없으면 메모리로 가서 데이터를 찾는데 이를 캐시 미스 cache miss라고 한다. <br>
캐시 히트가 되는 비율을 캐시 적중률cache hit ratio라고 하며, 일반적인 캐시 적중률은 약 90%이다.<br>
<br>
캐시의 적중률을 높이는 또다른 방법은 앞으로 사용될 데이터를 가져오는 것이다.<br>
이와 관련된 이론으로는 현재 위치에 가까운 데이터가 멀리 있는 데이터보다 사용될 확률이 더 높다는 지역성 locality 이론이 있다.<br>

###### * 지역성 이론에 따르면 프로그래밍 시 goto문을 사용하지 않는 것이 좋다. 미리 가져온 데이터가 쓸모없어지기 때문이다.
 
### 즉시 쓰기 write through
캐시에 있는 데이터가 변경되면 이를 즉시 메모리에 반영하는 방식이다.<br>
메모리와의 빈번한 데이터 전송으로 인해 성능이 느려지는 것이 단점이지만, 메모리의 최신 값이 항상 유지되기 때문에 갑작스러운 정전에도 데이터를 잃어버리지 않는다.<br>

### 지연 쓰기 write back
캐시에 있는 데이터가 변경되면 이를 즉시 메모리에 반영하는 것이 아니라 변경된 내용을 모아서 주기적으로 반영하는 방식으로, 카피 백 copy back이라고도 한다.<br>
메모리와 데이터 전송 횟수가 줄어들어 시스템의 성능 향상을 할 수 있으나 메모리와 캐시 된 데이터 사이의 불일치가 발생할 수도 있다는 것이 단점이다.<br>

### 레벨별 캐시
- 일반 캐시 : 명령어와 데이터의 구분 없이 모든 자료를 가져온다.
 - L2 캐시 : 메모리와 연결된다. = Level 2 캐시
- 특수 캐시 : 명령어와 데이터를 구분해서 가져온다.
 - L1 캐시 : 명령어 캐시는 명령어 레지스터와 연결되어있고, 데이터 캐시는 데이터 레지스터와 연결되어있다. 명령어 캐시나 데이터 캐시는 CPU레지스터에 직접 연결된다. = Level 1 캐시
 
###### * 웹 브라우저 캐시<br>
캐시가 소프트웨어적으로 사용되는 대표적인 예이다.<br>
웹에서 사용하는 캐시는 '앞으로 다시 방문할 것을 예상하여 지우지 않은 데이터'라고 정의할 수 있다.<br>
웹 브라우저 캐시는 방문했던 사이트의 데이터를 보관하여 재방문 시 속도를 높이는 역할을 한다.<br>
그러나 너무 많은 데이터가 캐시에 보관되어있으면 웹 브라우저의 속도를 떨어뜨릴 수 있으므로 가끔 청소를 하는 것이 좋다.<br>

------------


## 저장장치의 계층 구조
최고의 성능을 내는 컴퓨터 구성 방법은 다음과 같다.<br>

- 저장장치로 느린 하드디스크 대신 SSD 같은 빠른 플래시 메모리를 사용한다.
- 메모리를 하드디스크 크기만큼 확장한다.
- 캐시를 크게 늘려 캐시 적중률을 높인다.

하지만 위의 방법은 비용이 많이 들기 때문에 가격과 컴퓨터 성능 사이의 타협점으로 저장장치의 계층구조가 존재한다.<br>

### 저장장치의 계층구조 strage hierarchy
속도가 빠르고 값이 빠른 레지스터나 캐시를 를 CPU 가까운 쪽에 두고, 값이 싸고 용량이 큰 저장장치(ex. 하드디스크)를 반대쪽에 배치하여 적당한 가격으로 빠른 속도와 큰 용량을 동시에 얻는 방법이다. <br>
저장장치의 계층 구조는 사용자가 저렴한 가격으로 용량은 하드디스크처럼 사용하고 작업 속도는 레지스터처럼 빠르도록 만들어준다.<br>
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FOKaj5%2FbtrHwl80Vgn%2FrYV8O7EJGzFIE2B3PJpMQk%2Fimg.png)
중복되는 데이터의 일관성을 유지하는 것이 문제이다.<br>
CPU가 캐시에 저장된 데이터를 변경하면 메모리의 해당 주소에 있는 데이터도 갱신되어야 하는데, 변경된 내용을 즉시 반영하지 않고 일정기간 모았다가 한꺼번에 메모리에 반영하는 지연 쓰기의 경우 문제가 된다. 또한, 협업 중인 다른 작업에서 해당 데이터를 읽으려 한다면 일관성이 깨질 수 있다. 갑자기 전원이 꺼지기라도 하면 데이터를 잃어버릴 수 있다.<br>
버퍼를 사용하는 하드디스크같은 저장장치에서도 데이터의 일관성이 깨질 수 있다. 버퍼를 비우지 않았는데 하드웨어를 제거하면 일관성이 무너진다. <br>
분산된 데이터베이스에 같은 데이터가 저장되어있는 경우, CPU를 여러 개 사용하는 병렬컴퓨터의 분산된 메모리 등에서도 발생된다. <br>

------------


## 인터럽트
### 폴링 방식 Polling
초기의 컴퓨터 시스템에는 주변장치가 많지 않았기때문에, CPU가 직접 입출력 장치에서 데이터를 가져오거나 내보냈다.<br>

### 인터럽트
입출력 관리자가 CPU에 보내는 완료 신호를 인터럽트라고 한다.<br>

CPU는 입출력 관리자에게 작업지시를 내리고 다른 일을 하다가 완료 신호를 받으면 하던 일을 중단하고 옮겨진 데이터를 처리한다. 이처럼 하던 작업을 중단하고 처리해야 하는 의미에서 인터럽트라고 불린다. <br>
CPU의 작업과 저장장치의 데이터 이동을 독립적으로 운영함으로써 시스템의 효율을 높임으로써, 데이터의 입출력이 이루어지는 동안 CPU가 다른 작업을 할 수 있다.<br>


### 인터럽트 방식의 동작과정
1. CPU가 입출력 관리자에게 입출력 명령을 보낸다.
2. 입출력 관리자는 명령받은 데이터를 메모리에 가져다 놓거나 메모리에 있는 데이터를 저장장치로 옮긴다.
3. 데이터 전송이 완료되면 입출력 관리자는 완료 신호를 CPU에 보낸다.

### 메모리 매핑 입출력 Memory Mapped I/O; MMIO
CPU가 사용하는 메모리 공간과 직접 메모리 접근을 통해 들어오거나 나가는 데이터를 위한 공간을 분리하는 것이다.<br>
메모리의 일정 공간을 입출력에 할당하는 기법을 말한다.<br>

### 사이클 훔치기 Cycle stealing
CPU와 직접 메모리 접근이 동시에 메모리에 접근하려 할 경우 보통 CPU가 메모리 사용 권한을 양보한다.<br>
CPU의 작업 속도보다 입출력 장치의 속도가 느리기 때문에 직접 메모리 접근에 양보하는 것이다.
CPU입장에서 직접 메모리 접근이 사이클(순서)을 훔쳐 간 것이기 때문에 사이클 훔치기라고 말한다.<br>
