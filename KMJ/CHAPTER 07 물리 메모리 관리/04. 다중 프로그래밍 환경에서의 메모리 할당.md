# 다중 프로그래밍 환경에서의 메모리 할당
## 메모리 분할 방식
### 가변 분할 방식과 고정 분할 방식
- 가변 분할 방식 : 프로세스의 크기에 따라 메모리를 나누는 것. 관리 측면에서 매우 불편하다.
- 고정 분할 방식 : 프로세스의 크기와 상관없이 메모리를 같은 크기로 나누는 것. 관리 측면에서 보관에 용이하다.

### 메모리 분할 방식의 구현
#### 가변 분할 방식
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2Fuuan6%2FbtrKQio0lgi%2FwMCNel7PKOAeEwksrgaMhk%2Fimg.png)<br>
프로세스의 크기에 맞게 메모리가 분할되므로 메모리의 영역이 각각 다르다(17~40KB). 
한 프로세스가 연속된 공간에 배치되기 때문에 연속 메모리 할당(contiguous memory allocation)이라고 한다.<br>

- 장점<br>
프로세스를 한 덩어리로 처리하여 하나의 프로세스를 연속된 공간에 배치한다.<br>

- 단점<br>
메모리 관리가 복잡하다.<br>
위 그림에서 프로세스 B와 D가 작업을 마쳤을 경우 18KB와 17KB의 빈 공간이 생기는데 이때 19KB의 프로세스가 메모리에 올라오려고 하면 빈 공간이 떨어져 있기 때문에 올라올 수 없다.<br>
이 프로세스를 실행하기 위해서는 비어있는 공간을 하나로 합쳐야 하므로 이 과정에서 프로세스 C의 위치이동이 불가피하다.<br>

#### 고정 분할 방식
프로세스의 크기에 상관없이 메모리가 같은 크기로 나뉘며, 큰 프로세스가 메모리에 올라오면 여러 조각으로 나누어 배치된다.<br>
한 프로세스가 분산되어 배치되기 때문에 비연속 메모리할당(noncontiguous memory allocation)이라고 한다.<br>

- 장점<br>
메모리를 일정한 크기로 나누어 관리하기 때문에 메모리 관리가 수월하다(가변 분할 방식의 메모리 통합 같은 부가적인 작업 X).

- 단점<br>
일정하게 나누어진 공간보다 작은 프로세스가 올라올 경우 메모리 낭비가 발생할 수 있다.<br>
이때 남은 공간은 다른 프로세스가 사용할 수 없다.<br>

따라서 현대 운영체제에서 메모리 관리는 기본적으로 고정 분할 방식을 사용하면서 일부분은 가변 분할 방식을 혼합하고 있다.<br>

------------

## 가변 분할 방식의 메모리 관리 
가상 메모리 시스템에서는 가변 분할 방식을 세그먼테이션 기법이라고도 한다.<br>

### 프로세스 배치와 외부 단편화
16개의 의자가 놓인 일식집이 있다고 가정했을 때, 손님은 어디에 앉아도 상관없지만 함께 온 일행은 나란히 붙어서 식사를 해야 한다. <br>
이때 의자는 메모리에 비유되고 손님은 프로세스에 비유된다.<br>
<br>
가변 분할 방식은 빈 영역이 있어도 서로 떨어져 있으면 프로세스를 배정하지 못하는 문제가 있는데, 이로 인해 작은 조각들이 발생하는 현상을 단편화(fragmentation) 혹은 조각화라고 한다.<br>
또, 빈 공간보다 큰 프로세스가 들어오면 적당한 공간이 없어 메모리를 배정하지 못하는데, 이렇게 발생하는 작은 빈 공간을 외부 단편화(external fragmentation)라고 한다. (프로세스의 바깥쪽에 조각이 발생하기 때문에 이렇게 불린다)<br>
<br>
가변 분할 방식에서는 외부 단편화로 인한 문제를 해결하기 위해 메모리 배치 방색(memory placement strategy)이나 조각모음(defragmentation)을 사용한다.<br>
- 메모리 배치 방식 : 작은 조각들이 발생하지 않도록 프로세스를 배치
- 조각모음 : 조각이 발생했을 때 작은 조각들을 모아서 큰 덩어리로 만드는 작업

### 메모리 배치 방식
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FB1CxZ%2FbtrKYGJLSGv%2FZkjuGwRUgLOX9NAN3jOnc0%2Fimg.png)<br>
#### 최초 배치 first fit
단편화를 고려하지 않는 것으로, 프로세스를 메모리의 빈 공간에 배치할 때 메모리에서 적재 가능한 공간을 순서대로 찾다가 첫 번째로 발견한 공간에 프로세스를 배치하는 방법이다.<br>
빈 공간을 찾아다닐 필요가 없다.<br>

#### 최적 배치 best fit
메모리의 빈 공간을 모두 확인한 후 적당한 크기 가운데 가장 작은 공간에 프로세스를 배치한다.<br>
부가적인 작업이 있지만 딱 맞는 공간을 찾는 경우 단편화가 발생하지 않는다.<br>
하지만 딱 맞는 공간이 없는 경우 아주 작은 공간을 만들어내는 단점이 있다.<br>

#### 최악 배치 worst fit
최적 배치와 정반대. 빈 공간을 모두 확인한 후 가장 큰 공간에 프로세스를 배치한다.<br>
빈 공간의 크기가 클 경우 효과적이지만 빈 공간의 크기가 점점 줄어들면 최적 배치처럼 작은 조각을 만들어낸다.<br>

### 조각모음
단편화가 발생했을 경우 이미 배치된 프로세스를 옆으로 옮겨 빈 공간들을 하나의 큰 공간으로 만드는 작업을 말한다.<br>

#### 조각모음의 순서
1. 조각모음을 하기 위해 이동할 프로세스의 동작을 멈춘다.
2. 프로세스를 적당한 위치로 이동한다. 프로세스가 원래의 위치에서 이동하기 때문에 프로세스의 상대 주소 값을 바꾼다.
3. 이러한 작업을 다 마친 후 프로세스를 다시 시작한다.

조각모음은 이러한 순서로 진행되기때문에 많은 시간이 걸린다.<br>
이처럼 가변 분할방식은 외부 단편화로 인해 조각모음 같은 부가적인 작업이 필요하므로 메모리 관리가 복잡하다.<br>

####  하드디스크 조각모음
외부단편화는 하드디스크와 같은 저장장치에도 발생하는데, 데이터의 저장과 삭제를 반복하면서 데이터가 여러 공간에 나뉘어 저장된다.<br> 이러한 현상은 하드디스크의 입출력 속도를 떨어트려 컴퓨터의 성능을 저하하는 원인이 되기 때문에 성능을 유지하기 위해서는 주기적으로 조각모음을 실행해야 한다.<br>


------------

## 고정 분할 방식의 메모리 관리
가상 메모리 시스템에서는 고정 분할 방식을 페이징이라고도 한다. <br>프로세스의 크기에 상관없이 메모리를 같은 크기로 나누기 때문에 관리하기가 편하지만 프로세스가 메모리의 여러 조각에 나뉘어 저장되는 것이 문제이다.<br>

### 프로세스 배치와 내부 단편화
가변 분할 방식과 마찬가지로 16개의 의자가 놓인 일식집이 있다고 가정한다.<br>
단, 의자 2개씩 파티션으로 나누었으며 각 팀은 하나이상의 파티션에 앉는데 떨어져서 앉을 수도 있으며 함께 온 일행이 아니면 같은 파티션에 앉을 수 없다. <br>
<br>
다른 팀과 파티션을 공유할 수없기때문에 가변 분할 방식보다 비효율적으로 보이지만 오히려 공간을 더 효율적으로 관리할 수 있다.<br>
고정 분할 방식은 가변분할 방식처럼 조각모음을 할 필요가 없어 관리가 수월하므로 현대의 메모리 관리 시스템은 고정 분할 방식을 기본으로 사용하고 있다.<br>

### 내부 단편화
고정분할방식의 단점으로, 일정하게 나뉜 메모리의 크기보다 작은 프로세스가 배치될 경우 낭비되는 공간이 생긴 다는 것이다.<br>
이처럼 메모리 조각에 프로세스를 배치하고 공간이 남는 현상을 내부 단편화(internal fragmentation)라고 한다.<br>
같은 크기로 나뉜 공간의 내부에서 발생하기 때문에 이렇게 불린다.<br>
내부 단편화는 조각모음으로 해결할 수 없으며 남는 공간을 다른 프로세스에 배정할 수도 없기 때문에 동일하게 분할되는 공간의 크기를 조절하여 내부 단편화를 최소화한다.<br>
이때 메모리의 크기를 신중하게 결정해서 나누어야 하지만 사용하는 프로세스의 크기가 제각각이기 때문에 메모리를 얼마로 나누느냐에 관한 정답은 없다.<br>
<br>
| 구분 | 가변 분할 방식 | 고정 분할 방식 |
| --- | --- | --- |
| 메모리 단위 | 세그먼테이션 | 페이징 |
| 특징 | 연속 메모리 할당 | 비연속 메모리 할당 |
| 장점 | 프로세스를 한 덩어리로 관리 가능 | 메모리 관리가 편리 |
| 단점 | 빈 공간의 관리가 어려움 | 프로세스가 분할되에 처리됨 |
| 단편화 | 외부 단편화 | 내부 단편화 |

------------


### 버디 시스템 budy system
가변 분할 방식의 단점인 외부 단편화를 완화하는 방법이다.<br>
가변 분할 방식이지만 고정 분할 방식과 유사한 점이 있다.<br>

#### 버디 시스템의 작동 방식
가변 분할 방식과 고정 분할 방식의 중간 구조이다. <br>

1. 프로세스를 크기에 맞게 메모리를 1/2로 자르고 프로세스를 메모리에 배치한다.
2. 나뉜 메모리의 각 구역에는 프로세스가 1개만 들어간다.
3. 프로세스가 종료되면 주변의 빈 조각과 합쳐서 하나의 큰 덩어리를 만든다.

### 버디 시스템의 특징
가변 분할 방식과 고정 분할 방식의 특징을 모두 가지고 있다.<br>
가변 분할 방식처럼 메모리가 프로세스 크기대로 나뉘며, 고정 분할 방식처럼 하나의 구역에 다른 프로세스가 들어갈 수 없고, 메모리의 한 구역 내부에 조각이 생겨 내부 단편화가 발생한다.<br>
버디 시스템은 비슷한 크기의 덩어리가 서로 모여있어 통합하기 쉽기 때문에 조각모음을 하지 않아도 효과적으로 공간을 관리할 수 있다. <br>

------------


효율적인 공간관리 측면에서 보면 고정 분할 방식과 버디 시스템은 비슷한 수준이지만 공간을 1/2로 나누어가면서 메모리를 배분하는 버디 시스템보다 모든 공간을 똑같은 크기로 나누는 고정 분할 방식이 메모리 관리 측면에서 단순하기 때문에 버디 시스템보다 고정 분할 방식이 많이 사용되고 있다.

