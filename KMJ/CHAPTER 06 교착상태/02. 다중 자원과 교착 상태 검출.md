# 다중 자원과 교착 상태 검출
## 다중 지원과 사이클
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FZX8vM%2FbtrJ8lZj2LN%2F8tLLm0oLsuSgptLkPku0A0%2Fimg.png)<br>
자원 R1은 두 프로세스가 동시에 사용할 수 있는 다중 자원이다.<br>
프로세스 P1은 R1을 사용하면서  R2를 기다리고, 프로세스 P2는 자원 R2를 사용하면서 R1도 사용하고 있다.<br>
사이클이 형성되어 교착상태 같지만 R1의 자원의 수가 2개이므로 프로세스 P2가 자원 R1과 R2를 사용하여 작업을 마친 후 프로세스 P1이 자원 R2를 사용하여 작업을 마쳐 교착상태가 발생하지 않는다.<br>
<br>
이와 같이 다중 자원의 경우 사이클이 있다고 해서 모두 교착상태가 되는 것은 아니다. <br>

## 대기 그래프와 그래프 감소
### 대기 그래프(wait for graph)
자원 할당 그래프에서 프로세스와 프로세스 간에 기다리는 관계만 나타낸 그래프이다.<br>

### 그래프 감소(graph reduction)
대기 그래프에서 작업이 끝날 가능성이 있는 프로세스의 화살표와 관련된 프로세스의 화살표를 연속적으로 지워가는 작업을 말한다.<br>
작업이 끝날 가능성이 있는 프로세스란 기다리는 자원이 없는 프로세스를 가리킨다.<br>
이렇게 다중 지원이 있는 대기 그래프에서 그래프 감소를 완료한 후에도 사이클이 남아있다면 교착상태가 발생한 것으로 판단한다.<br>

####  다중 자원 사용 시 교착 상태가 발생하지 않는 경우
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbsARBZ%2FbtrJ6ZQMS6y%2FsV3jZ2wnSbiTRvVZrLLKh1%2Fimg.png)<br>
자원 할당 그래프에서 자원 R2는 두 프로세스가 동시에 사용할 수 있는 다중 자원으로, 현재 프로세스 P2와 P3에 할당되어 있다. <br>
대기 그래프에서는 화살표 위의 숫자로 그래프 감소 순서를 알 수 있다.<br>
그래프 감소 결과 사이클이 남아있지 않으므로 교착상태가 발생하지 않는다.<br>

1. 작업이 끝날 수 있는 프로세스, 즉 기다리는 자원이 없는 프로세스 P2에 대해 프로세스 P1에서 P2로 가는 화살표를 지운다.
2. 프로세스 P1이 작업을 종료할 수 있으므로 프로세스 P4에서 P1로 가는 화살표를 지운다.
3. 프로세스 P4가 작업을 종료할 수 있으므로 프로세스 P3에서 P4로 가는 화살표를 지운다.
4. 프로세스 P3이 작업을 종료할 수 있으므로 프로세스 P1에서 P3로 가는 화살표를 지운다.

#### 다중 자원 사용 시 교착 상태가 발생하는 경우
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FU2RUs%2FbtrJ7rsRIR4%2FRUiyO08fia46s9gAUuRlp0%2Fimg.png)<br>
작업이 끝날 수 있는(기다리는 자원이 없는) 프로세스가 존재하지 않기 때문에 그래프 감소를 해도 여전히 사이클이 남아있어 교착 상태가 발생한다.<br>
결론적으로 단일 자원만 있는 자원 할당 그래프에서는 사이클만으로 교착 상태 검출이 가능하지만, 다중 자원을 사용할 때는 그래프 감소를 한 후 사이클이 남아있는지 확인하여 교착 상태를 검출한다. <br>




