# 프로세스 제어 블록과 문맥 교환
## 프로세스 제어 블록
### 프로세스 제어 블록 PCB
프로세스를 실행하는데 필요한 중요한 정보를 보관하는 자료 구조로 TCB(Task Control Block)라고도 한다.<br>
<br>
모든 프로세스는 고유의 프로세스 제어 블록을 가지며, 프로세스 제어 블록은 프로세스 생성 시 만들어져서 프로세스가 실행을 완료하면 폐기된다.<br>

### 프로세스 제어 블록의 구성
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FdEC4ND%2FbtrHI2CaQQN%2FpFbk6v3S97P73zcM1JKyd0%2Fimg.png)
- **포인터** : 준비 상태나 대기상태는 큐로 윤영 되는데, 프로세스 제어 블록을 연결하여 준비 상태나 대기 상태의 큐를 구현할 때 포인터를 사용한다. 
- **프로세스 상태** : 생성, 준비, 실행, 대기, 보류 준비, 보류 대기 등이 있다. 이는 프로세스가 현재 어떤 상태에 있는지를 나타낸다.
- **프로세스 구분자** : 운영체제 내에 있는 여러 프로세스를 구별하기 위한 구분자를 저장한다.
- **프로세스 카운터** : 다음에 실행될 명령어의 위치를 가리키는 프로그램 카운터의 값을 저장한다.
- **프로세스 우선순위** :  사용자 프로세스보다 중요도가 큰 커널 프로세스는 우선순위가 높고, 사용자 프로세스끼리도 우선순위가 다르다. 다양한 우선순위의 프로세스가 대기 상태로 들어오기 때문에 대기 상태의 큐도 우선순위별로 운영된다. CPU 스케줄러가 준비 상태에 있는 프로세스 중 실행 상태로 옮겨야 할 프로세스를 선택할 때는 프로세스 우선순위를 기준으로 삼는다. 높은 우선순위의 프로세스가 낮은 프로세스보다 먼저, 더 자주 실행된다.
- **각종 레지스터 정보** : 레지스터를 포함해 누산기 accumulator, 색인 레지스터 index register, 스택 포인터 stack pointer와 같은 레지스터의 값이 저장된다. 이전에 실행할 때 사용한 레지스터의 값을 보관해야 다음에 실행할 수 있기 때문에 자신이 사용하던 레지스터의 중간 값을 보관한다.
- **메모리 관리 정보** : 프로세스가 메모리의 어디에 있는지 나타내는 메모리 위치 정보, 메모리 보호를 위해 사용하는 경계 레지스터 값과 한계 레지스터 값 등이 저장된다. 그 외에 세그먼테이션 테이블 segmentation table, 페이지 테이블 page table 등의 정보도 보관한다.
- **할당된 자원 정보** : 프로세스를 실행하기 위해 사용하는 입출력 자원이나 오픈 파일에 대한 정보를 말한다. 
- **계정 정보** : 계정 번호, CPU 할당시간, CPU 사용 시간 등으로, 이러한 정보는 프로세스 제어 블록에 저장된다.
- **부모 프로세스 구분자와 자식 프로세스 구분자** : 부모 프로세스Parent process를 가리키는 PPID(Parent PID)와 자식 프로세스 child process를 가리키는 CPID(Child PID) 정보도 저장된다. 

------------

## 문맥 교환 Context switching
문맥 교환은 CPU를 차지하던 프로세스가 나가고 새로운 프로세스를 받아들이는 작업을 말한다. 실행 상태에서 나가는 프로세스 제어 블록에는 지금까지의 작업 내용을 저장하고, 반대로 실행 상태로 들어오는 프로세스 제어 블록의 내용으로  CPU가 다시 세팅된다. <br>이와 같이 두 프로세스의 프로세스 제어 블록을 교환하는 작업이 문맥 교환이다.<br>

### 문맥 교환의 절차
![](https://img1.daumcdn.net/thumb/R1280x0/?scode=mtistory2&fname=https%3A%2F%2Fblog.kakaocdn.net%2Fdn%2FbX2Q4U%2FbtrHJzmeueB%2F9wmK96yGan79RfktVsHXDK%2Fimg.png)<br>
실행상태에 있는 프로세스 P1이 자신에게 주어진 시간을 다 사용해 타임아웃이 되면 프로세스 P1의 프로세스 제어 블록에 현재까지의 작업 결과가 저장되고 P1은 준비상태로 쫓겨난다.<br> 준비상태에 있던 프로세스 P2가 실행 상태로 가면 CPU의 레지스터가 P2의 레지스터 제어 블록 값으로 채워져 다음 작업을 하게 된다.<br>
<br>
문맥 교환이 일어나는 경우는 다양하다. 일반적으로 한 프로세스가 자신에게 주어진 시간을 다 사용하면 발생하고, 인터럽트가 걸렸을 때도 발생한다. <br>


