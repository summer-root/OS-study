# 디스크 장치

## 디스크 장치의 종류

### 하드디스크

하드디스크는 1956년 처음 개발될 당시 23인치의 크기에 용량은 5MB 정도였다. 당시에는 테이프 드라이브같이 순차적으로 접근하는 저장장치밖에 없었는데, 맨 뒤에 있는 데이터를 읽으려면 테이프를 끝까지 감아야 했다. 하드디스크는 이와 달리 원반을 사용한 저장장치로 맨 앞에 있는 데이터나 맨 뒤에 있는 데이터에 접근하는 속도가 거의 비슷하다.

하드디스크는 메모리를 보조하는 장치라는 의미에서 제2저장장치라고도 불린다. 스핀들이라는 원통 축에 여러 개의 플래터가 달려 있다.

![하드디스크의 구조](https://github.com/summer-root/OS-study/blob/main/NEH/CHAPTER%2010%20%EC%9E%85%EC%B6%9C%EB%A0%A5%20%EC%8B%9C%EC%8A%A4%ED%85%9C%EA%B3%BC%20%EC%A0%80%EC%9E%A5%EC%9E%A5%EC%B9%98/%EC%82%AC%EC%A7%84%20%EC%B2%A8%EB%B6%80/%ED%95%98%EB%93%9C%EB%94%94%EC%8A%A4%ED%81%AC%EC%9D%98%20%EA%B5%AC%EC%A1%B0.png)

- 플래터 

  플래터는 표면에 자성체가 발려 있어 자기를 이용하여 0과 1의 데이터를 저장할 수 있다. 플래터의 표면이 N극을 띠면 0으로, S극을 띠면 1로 인식한다. 플래터의 수는 하드디스크마다 다르지만 보통 2장 이상으로 구성되며 항상 일정한 속도로 회전한다. 

  한 플래터의 위아래 표면을 다 사용하므로 2개의 표면에 데이터가 저장된다. 하지만 일부 모델에서는 맨 아래 또는 맨 위 디스크의 바깥 면을 사용하지 않는다. 3.5인치 지름의 플래터를 사용하는 하드디스크와 2.5인치 지름의 플래터를 사용하는 하드디스크로 나뉜다.

- 섹터와 블록

  물리적인 개념인 섹터는 하드디스크의 가장 작은 저장 단위이다. 하나의 섹터에는 한 덩어리의 데이터가 저장된다. 블록은 하드디스크와 컴퓨터 사이에 데이터를 전송하는 논리적인 저장 단위 중 가장 작은 단위이다. 블록은 여러 개의 섹터로 구성되며, 윈도우 운영체제에서는 클러스터라고 표현한다. 

  메모리에서는 물리적으로 하나의 바이트마다 주소가 배정된다. 그러나 하드디스크에서는 블록마다 주소가 배정된다.

- 트랙과 실린더

  트랙은 플래터에서 회전축을 중심으로 데이터가 기록되는 동심원, 즉 동일한 동심원 상에 있는 섹터의 집합을 말한다. 헤드는 디스크 암에 고정되어 있기 때문에 모든 헤드가 항상 같이 움직인다. 따라서 헤드는 여러 플래터의 같은 위치에 있는 트랙을 동시에 읽거나 쓸 수 있다. 여러 개의 플래터에 있는 같은 트랙의 집합을 실린더라고 부른다.

- 헤드와 플래터

  하드디스크에서 데이터를 읽거나 쓸 때는 읽기/쓰기 헤드를 사용한다. 헤드의 수는 데이터가 저장되는 플래터의 표면 수와 같다. 플래터가 회전을 시작하면 표면에 약한 바람이 일어나는데, 헤드는 이 바람에 의해 표면에서 약간 떠 있는 형태로 작동한다. 만약 헤드가 플래터에 붙어 플래터에 상처가 생기면 해당 부분은 데이터를 저장할 수 없는 배드 섹터가 된다.

  컴퓨터가 종료될 때 하드디스크는 헤드가 플래터의 표면에 흠집을 내지 않도록 헤드를 데이터가 저장되지 않는 바깥쪽으로 이동하는데 이를 파킹이라고 한다.

<br>



:pencil2: SSD

SSD는 하드디스크의 느린 속도를 대체하기 위해 사용하는 비휘발성 메모리이다. SSD는 플래시 메모리를 이용하기 때문에 속도가 빠르고 모터를 이용한 구동 부분이 없기 때문에 외부 충격에 강하다. 또한 하드디스크보다 가볍고 전력 소비량도 적다. 하지만 하드디스크에 비해 가격이 비싸다.

<br>



### CD

하드디스크와 마찬가지로 CD도 트랙과 섹터로 구성되며, 수평으로 움직이는 헤드가 트랙 사이를 움직이면서 데이터를 읽는다. 하지만 하드디스크와는 다르게 CD는 표면에 미세한 홈이 파여 있어 헤드에서 발사된 레이저가 홈에 들어가 반사가 되지 않으면 0, 반사가 되면 1로 인식한다. CD에 데이터를 저장할 때는 레이저를 쏘아 표면을 태워 미세한 홈을 만드는 방식으로 저장한다.

<br>



### 하드디스크와 CD의 비교

하드디스크와 CD는 둘 다 원반을 사용하지만 구동 방식이 다르다. 하드디스크의 경우 디스크가 작동하는 동안 플래터가 일정한 속도로 돌아가지만, CD의 경우 헤드 위치에 따라 디스크의 회전 속도가 변한다. 

![디스크 장치의 회전 비교](https://github.com/summer-root/OS-study/blob/main/NEH/CHAPTER%2010%20%EC%9E%85%EC%B6%9C%EB%A0%A5%20%EC%8B%9C%EC%8A%A4%ED%85%9C%EA%B3%BC%20%EC%A0%80%EC%9E%A5%EC%9E%A5%EC%B9%98/%EC%82%AC%EC%A7%84%20%EC%B2%A8%EB%B6%80/%EB%94%94%EC%8A%A4%ED%81%AC%20%EC%9E%A5%EC%B9%98%EC%9D%98%20%ED%9A%8C%EC%A0%84%20%EB%B9%84%EA%B5%90.png)

- 각속도 일정 방식의 회전 : 하드디스크의 플래터는 항상 일정한 속도로 회전하여 바깥쪽 트랙의 속도가 안쪽 속도의 트랙보다 훨씬 빠르다. 따라서 바깥쪽에 있는 섹터가 가장 안쪽에 있는 섹터보다 더 크다. 일정한 시간 동안 이동한 각도가 같다.
- 선속도 일정 방식의 회전 : CD의 경우 어느 트랙에서나 단위 시간 당 디스트의 이동 거리가 같다. 헤드가 안쪽에 있을 때는 디스크의 회전 속도가 빨라지고, 헤드가 바깥쪽 트랙으로 이동했을 때는 디스크의 속도가 느려진다.

<br>



하드디스크의 각속도 일정 방식과 CD의 선속도 일정 방식은 섹터의 구성이 다르다.

- 각속도 일정 방식의 섹터 : 하드디스크는 트랙마다 속도가 다르기 때문에 섹터의 크기도 다르다. 모든 트랙의 섹터 수가 같고 바깥쪽 섹터의 크기가 안쪽 섹터보다 크다. 따라서 안쪽 트랙에 비해 바깥쪽 트랙으로 갈수록 낭비되는 공간이 생기는 것이 단점이다. 그러나 디스크가 일정한 속도로 회전하기 때문에 구동장치가 단순하고 조용하게 작동한다.
- 선속도 일정 방식의 섹터 : CD는 모든 트랙의 움직이는 속도가 같고 섹터의 크기도 같다. 따라서 안쪽 트랙보다 바깥쪽 트랙에 더 많은 섹터가 존재한다. 모든 트랙의 섹터 수가 다른 것이다. CD는 한정된 공간에 많은 데이터를 담을 수 있고 하드디스크처럼 바깥쪽 트랙의 섹터 공간이 낭비되는 문제가 없으나 모터 제어가 복잡하고 소음이 발생하는 것이 단점이다.

<br>



CD는 트랙마다 회전하는 속도가 다르기 때문에 rpm으로 성능을 표현할 수 없어 최초로 만들어진 CD-ROM을 기준으로 최대 전송 속도를 표시한다. 예를 들어 최초의 CD-ROM이 1초에 150KB를 전송한다면 이를 1배속이라고 가정하여 비율로 표시한다.

CD와 하드디스크의 또 다른 차이점은 하드디스크의 경우 바깥쪽에서 안쪽으로 데이터가 채워지지만, CD의 경우 안쪽부터 바깥쪽으로 데이터가 채워진다. CD는 트랙의 시작과 데이터의 위치 등 중요한 내용을 가장 안쪽 트랙에 저장한다.

<br>



## 디스크 장치의 데이터 전송 시간

하드디스크에서 데이터를 전송하는 과정은 다음과 같다.

![하드디스크의 데이터 전송 과정](https://github.com/summer-root/OS-study/blob/main/NEH/CHAPTER%2010%20%EC%9E%85%EC%B6%9C%EB%A0%A5%20%EC%8B%9C%EC%8A%A4%ED%85%9C%EA%B3%BC%20%EC%A0%80%EC%9E%A5%EC%9E%A5%EC%B9%98/%EC%82%AC%EC%A7%84%20%EC%B2%A8%EB%B6%80/%ED%95%98%EB%93%9C%EB%94%94%EC%8A%A4%ED%81%AC%EC%9D%98%20%EB%8D%B0%EC%9D%B4%ED%84%B0%20%EC%A0%84%EC%86%A1%20%EA%B3%BC%EC%A0%95.png)

1. 하드디스크의 특정 섹터에 저장된 데이터를 읽거나 쓰려면 그 섹터가 있는 트랙까지 헤드가 이동해야 한다. 이처럼 헤드가 현재 위치에서 그 트랙까지 이동하는 데 걸리는 시간을 탐색 시간이라고 한다.
2. 특정 트랙까지 이동한 헤드는 플래터가 회전하여 원하는 섹터를 만날 때까지 기다린다. 이 시간을 회전 지연 시간이라고 한다.
3. 헤드는 원하는 섹터에 있는 데이터를 읽어 전송한다. 이때 걸리는 시간을 전송 시간이라고 한다.

하드디스크에서 데이터를 가져오는 데 걸리는 총 시간은 다음과 같다.

```데이터 전송 시간 = 탐색 시간 + 회전 지연 시간 + 전송 시간```

<br>



디스크의 데이터 전송 시간 비중은 다음과 같다.

탐색 시간 >> 회전 지연 시간 = 전송 시간

따라서 탐색 시간을 최소화하면 하드디스크의 성능이 높아진다. 탐색 시간을 최소화 하기 위해서는 조각 모음을 자주 하거나 상황에 맞는 디스크 스케줄링 기법을 사용해야 한다.

<br>



## 디스크 장치 관리

디스크 장치 사용에는 다음과 같은 관리 기법이 필요하다.

<br>



### 파티션

디스크를 논리적으로 분할하는 작업이다. 대용량 하드디스크의 경우 여러 개로 나누어 사용하면 관리가 편하다. 

하드디스크가 많은 경우 운영체제에서 여러 개의 파티션을 관리하는 일이 복잡해진다. 유닉스에서는 여러 개의 하드디스크를 하나의 파티션으로 통합하는 기능을 가지고 있다. 이를 마운트라고 한다.

<br>



### 포매팅

파티션이 결정되면 포매팅을 해야 한다. 포매팅은 디스크에 파일 시스템을 탑재하고 디스크 표면을 초기화하여 사용할 수 있는 형태로 만드는 작업을 말한다. 저장장치에서는 디스크에 저장된 파일의 위치와 크기 정보를 담을 파일 테이블을 사용한다. 포매팅은 파일 시스쳄을 각 파티션의 상탄부에 탑재하고 저장장치의 모든 섹터를 0으로 만들어 운영체제가 하드디스크를 사용할 수 있도록 준비하는 작업이다.

<br>

운영체제의 파일 테이블

- 윈도우 : FAT, NTFS
- 유닉스 :  I-node

<br>



포매팅은 빠른 포메팅과 느린 포매팅으로 나뉜다.

- 느린 포매팅 : 일반적 포매팅 방식
- 빠른 포매팅 : 데이터는 그대로 둔 채 파일 테이블을 초기화
- low level 포매팅 : 하드디스크를 공장에서 출하한 상태로 되돌리는 작업으로 파일시스템, 파티션, 섹터, 트랙 정보 모두 삭제

저장장치 사용 도중 배드 섹터를 찾고 싶다면 느린 포매팅을 사용하여 모든 섹터를 검사해야 한다. 느린 포매팅은 모든 섹터를 0으로 만드는 동시에 배드 섹터를 찾는 일도 같이 한다.

<br>



### 조각 모음

하드디스크를 사용하다 보면 파일을 저장했다가 지우며 중간에 빈 공간이 생기게 된다. 이를 조각화 또는 단편화라고 부른다. 이렇게 하드디스크에 조각이 많이 생기면 큰 파일이 여러 조각으로 나뉘어 저장되고, 이를 읽기 위해 하드디스크의 여러 곳을 돌아다녀야 하기 때문에 성능 저하로 이어진다. 

조각 모음은 조각화를 제거하는 것이다. 조각 모음을 하여 특정 위치의 메모리만 계속 사용하면 수명이 단축된다. USB나 SSD 같은 반도체를 이용한 저장장치는 조각 모음을 하지 않아도 된다.

<br>



## 네트워크 저장장치

### DAS

서버와 같은 컴퓨터에 직접 연결된 저장장치를 말하며 HAS라고도 한다. 

DAS는 컴퓨터의 메인보드에 있는 입출력 버스와 연결된다. 이 버스를 사용하는 방식은 IDE → E-IDE → SATA로 변화되어 왔다. 이러한 변화는 연결의 간편성, 최대 전송 속도와 연관된다. 외부 저장장치와 컴퓨터 내부 버스를 연결하는 데 USB 또는 Firewire를 사용한다.

DAS는 컴퓨터에 직접 연결된 저장장치를 사용하기 때문에 다른 운영체제가 쓰는 파일 시스템을 사용할 수 없다. 또한 데이터 관리나 백업을 사용자가 직접 해야 한다.

<br>



### NAS

기존의 장치를 LAN이나 WAN에 붙여 사용하는 방식이다.

NAS 전용 운영체제를 가진 독립적인 장치로 새로운 하드디스크를 추가하거나 뺄 수 있다. 저장장치가 네트워크 상에 있기 때문에 공유 데이터의 관리 및 데이터의 중복 회피가 가능하다.

사용자 인터페이스를 이용하여 다양한 파일 관리가 가능하도록 구현되었다.

<br>



### SAN

NAS보다 진보된 형태의 네트워크 저장장치이다. 데이터 서버, 백업 서버, RAID 등의 장치를 네트워크로 묶고 데이터 접근을 위한 서버를 두는 형태이다. 시스템이 제공하는 인터페이스를 통해 데이터에 접근한다.

사용자가 파일 관리에 특별히 신경을 쓸 필요가 없어 편하지만, 구축 비용이 많이 든다. 광 채널을 이용하여 구성한 것은 FC-SAN이라고 하며, TCP/IP 프로토콜을 이용한 것은 IP-SAN이라고 한다.

