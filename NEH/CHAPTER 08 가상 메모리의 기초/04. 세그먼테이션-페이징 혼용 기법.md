# 세그먼테이션-페이징 혼용 기법

## 메모리 접근 권한

메모리 접근 권한은 메모리의 특정 번지에 저장된 데이터를 사용할 수 있는 권한으로 읽기, 쓰기, 실행, 추가 권한이 있다. 이 권한은 복합적으로 사용된다.

추가 권한의 경우 해당 데이터의 마지막에 새로운 데이터를 추가하는 것이므로 항상 쓰기 권한이 동반되어야 한다. 따라서 추가 권한을 쓰기 권한과 같이 취급하여 총 8가지 접근 방식이 존재한다.



| 구분   | 읽기 | 쓰기 | 실행 | 비고                 |
| ------ | ---- | ---- | ---- | -------------------- |
| 모드 0 | X    | X    | X    | 접근 불가            |
| 모드 1 | X    | X    | O    | 실행만 가능          |
| 모드 2 | X    | O    | X    | 실제로 사용하지 않음 |
| 모드 3 | X    | O    | O    | 실제로 사용하지 않음 |
| 모드 4 | O    | X    | X    | 읽기 전용            |
| 모드 5 | O    | X    | O    | 읽고 실행 가능       |
| 모드 6 | O    | O    | X    | 읽고 쓰기 가능       |
| 모드 7 | O    | O    | O    | 제한 없음            |

읽기 권한 없이 쓰기를 하는 경우는 거의 없기 때문에 모드 2와 3은 실제로 쓰이지 않는다.

<br>



코드 영역과 데이터 영역의 접근 권한은 다음과 같다.

- 코드 영역 : 자기 자신을 수정하는 프로그램은 없기 때문에 읽기 및 실행 권한을 가진다.
- 데이터 영역 : 데이터는 크게 읽거나 쓸 수 있는 데이터와 읽기만 가능한 데이터로 나눌 수 있다. 일반적인 변수는 읽기 및 쓰기 권한을 가지고 상수로 선언한 변수는 읽기 권한만 가진다.

<br>



메모리 접근 권한 검사는 가상 주소에서 물리 주소로 주소 변환이 일어날 때마다 시행된다. 읽기만 가능한 메모리 영역에 쓰기를 하려고 하면 메모리 오류인 트랩이 발생한다. 

<br>



## 세그먼테이션-페이징 혼용 기법의 도입

페이지마다 접근 권한이 다르므로 페이지 테이블의 모든 행에 메모리 접근 권한과 관련된 권한 비트가 추가된다. 메모리 관리자는 주소 변환이 이루어질 때마다 페이지 테이블의 권한 비트를 이용하여 유용한 접근인지 확인한다.

페이지 테이블에 권한 비트가 추가되면 페이지 테이블의 크기가 커진다. 이 문제를 완화하려면 반복되는 권한 비트를 줄여야 한다. 권한 비트 추가에 따라 페이지 테이블의 크기가 커지는 문제는 세그먼테이션 테이블을 이용하여 해결할 수 있다. 

페이지로 분할된 가상 주소 공간에서 서로 관련 있는 영역을 하나의 세그먼트로 묶어 세그먼테이션 테이블로 관리하고, 각 세그먼트를 구성하는 페이지를 해당 페이지 테이블로 관리하는 방식이다. 각 세그먼테이션 테이블은 자신과 연결된 페이지 테이블의 시작 주소를 가진다.

![페이징 테이블과 세그먼테이션 테이블의 혼합](https://github.com/summer-root/OS-study/blob/main/NEH/CHAPTER%2008%20%EA%B0%80%EC%83%81%20%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%9D%98%20%EA%B8%B0%EC%B4%88/%EC%82%AC%EC%A7%84%20%EC%B2%A8%EB%B6%80/%ED%8E%98%EC%9D%B4%EC%A7%95%20%ED%85%8C%EC%9D%B4%EB%B8%94%EA%B3%BC%20%EC%84%B8%EA%B7%B8%EB%A8%BC%ED%85%8C%EC%9D%B4%EC%85%98%20%ED%85%8C%EC%9D%B4%EB%B8%94%EC%9D%98%20%ED%98%BC%ED%95%A9.png)

이렇게 페이징 기법과 세그먼테이션 기법을 혼합하여 사용하면 두 기법의 장점만 취하기 때문에 메모리 관리를 효율적으로 할 수 있다. 현재 대부분의 운영체제는 이 방식을 사용한다.

<br>

세그먼테이션-페이징 혼용 기법을 사용하면 모든 페이지 테이블에 새로운 속성 필드를 추가하지 않아도 데이터의 소유 권한과 접근 권한을 세그먼테이션 테이블에서 관리할 수 있다. 

<br>



## 세그먼테이션-페이징 혼용 기법의 주소 변환

![세그먼테이션-페이징 혼용 기법](https://github.com/summer-root/OS-study/blob/main/NEH/CHAPTER%2008%20%EA%B0%80%EC%83%81%20%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%9D%98%20%EA%B8%B0%EC%B4%88/%EC%82%AC%EC%A7%84%20%EC%B2%A8%EB%B6%80/%EC%84%B8%EA%B7%B8%EB%A8%BC%ED%85%8C%EC%9D%B4%EC%85%98-%ED%8E%98%EC%9D%B4%EC%A7%95%20%ED%98%BC%EC%9A%A9%20%EA%B8%B0%EB%B2%95.jpg)

세그먼테이션-페이징 혼용 기법에서는 가상 주소를 VA = <S, P, D>로 표현한다.

- S : 세그먼트 번호
- P : 페이지 번호
- D : 페이지의 처음 위치에서 해당 주소까지의 거리

<br>



세그먼테이션-페이징 혼용 기법에서 가상 주소를 물리 주소로 변환하는 과정

1. 사옹자가 어떤 주소에 있는 데이터를 요청하면 해당 주소가 몇 번째 세그먼트의 몇 번째 페이지로부터 얼마나 떨어져 있는지 계산하여 가상 주소 VA = <S, P, D>를 구한다.
2. 세그먼테이션 테이블의 해당 세그먼트 번호로 가서 권한이 있는지 등을 확인한다. 정상 접근인 경우 연결된 페이지 테이블로 간다.
3. 페이지 테이블에서 해당 페이지가 어느 프레임에 저장되어 있는지 찾는다.
4. 물리 메모리에 있는 프레임의 처음 위치에서 D만큼 떨어진 곳에 접근하여 데이터를 읽거나 쓴다.

