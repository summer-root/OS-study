# 캐시 매핑 기법

페이지 테이블의 매핑 방식은 캐시에서도 비슷하게 사용된다. 그러나 캐시의 크기는 메모리보다 작기 때문에 항상 메모리의 일부 페이지만 가지고 있다. 따라서 페이지 테이블의 직접 매핑과 캐시의 직접 매핑은 의미하는 바가 다르다.

<br>



## 캐시 직접 매핑

캐기도 메모리의 페이징 방식처럼 메모리를 일정 크기로 나누는데, 일정 크기로 나눈 덩어리를 페이지 P라고 부른다. CPU가 메모리에 접근하려고 할 때 사용하는 주소를 <P, D>로 표현하며, P는 페이지 번호, D는 페이지 내에서 거리를 의미한다. 여기까지는 페이징 기법과 똑같다.

<br>

메모리는 N개의 페이지로 구성되고, 캐시는 M개의 페이지로 구성된다. 캐시는 메모리보다 작기 때문에 N이 M보다 크다. 직접 매핑에서는 메모리의 페이지 수 N을 캐시의 페이지 수 M으로 나누고 이를 블록이라고 부른다. 따라서 메모리의 페이지 수 N은 M × 블록의 수가 된다. 

직접 매핑에서는 메모리의 블록이 캐시로 올라올 때 항상 같은 위치에 올라온다. 즉 블록의 첫 번째 페이지는 캐시의 첫 번째 페이지로만 올라온다.

직접 매핑에서는 캐시에 블록의 일정 위치 데이터가 올라오기 때문에 메모리의 어떤 블록에서 올라온 페이지인지만 확인하면 된다. 따라서 캐시에 블록 번호를 명시하는데 이를 태그라고 한다. 캐시 히트나 캐시 미스를 알기 위해 태그를 확인한다. CPU가 메모리에 접근하려는 주소 <P, D>는 <tag, db, D>로 바꿀 수 있고, 데이터를 캐시에 얻기 위해 <tag, D>를 사용한다. bd는 블록에서의 거리를 의미한다.

<br>

캐시 직접 매핑 구조

![캐시 직접 매핑](https://github.com/summer-root/OS-study/blob/main/NEH/CHAPTER%2008%20%EA%B0%80%EC%83%81%20%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%9D%98%20%EA%B8%B0%EC%B4%88/%EC%82%AC%EC%A7%84%20%EC%B2%A8%EB%B6%80/%EC%BA%90%EC%8B%9C%20%EC%A7%81%EC%A0%91%20%EB%A7%A4%ED%95%91.jpg)

주소 4bit 중 앞의 2bit는 태그를 나타내며 블록 번호를 의미한다. 뒤의 2bit는 블록에서의 거리로 올라가야 할 캐시의 위치 정보를 나타낸다.

<br>

직접 매핑 방식의 가장 큰 특징은 메인메모리의 페이지가 캐시의 정해진 위치에만 들어갈 수 있다는 것이다. 예를 들어 00은 캐시의 00 위치에만 올라갈 수 있기 때문에 00 위치에는 lion, chicken, tuna, snake만 올라올 수 있다. 

현재 캐시의 00 위치에 어떤 데이터가 올라왔는지 확인하기 위해 캐시에서는 태그를 유지한다. 

직접 매핑의 장점은 메모리의 페이지가 캐시의 같은 위치에 올라오기 때문에 태그만 확인하면 캐시 히트나 캐시 미스를 빠르게 확인할 수 있다. 그러나 페이지가 같은 위치에만 올라오기 때문에 자리다툼이 발생하는 단점이 있다. 만약 캐시의 00 위치에 있는 데이터 두 개가 연속으로 필요한 경우 캐시에 여유가 있어도 해당 위치만 사용하기 때문에 캐시 적중률이 떨어진다. 이 문제를 완화한 방법이 연관 매핑이다.

<br>



## 캐시 연관 매핑

캐시 연관 매핑은 페이지 테이블의 연관 매핑과 동일하다. 메모리 워드가 어느 위치에도 자유롭게 올라갈 수 있으므로 캐시가 메모리 워드의 주소를 전부 가지고 있다. 연관 매핑은 캐시 메모리를 자유롭게 사용할 수 있다는 것이 장점이다. 하지만 캐시 히트인지 캐시 미스인지 알기 위해 캐시의 모든 주소를 검색해야 한다. 따라서 연관 매핑은 직접 매핑보다 느리다.

![캐시 연관 매핑](https://github.com/summer-root/OS-study/blob/main/NEH/CHAPTER%2008%20%EA%B0%80%EC%83%81%20%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%9D%98%20%EA%B8%B0%EC%B4%88/%EC%82%AC%EC%A7%84%20%EC%B2%A8%EB%B6%80/%EC%BA%90%EC%8B%9C%20%EC%97%B0%EA%B4%80%20%EB%A7%A4%ED%95%91.jpg)

<br>



## 캐시 집합-연관 매핑

집합-연관 매핑은 직접 매핑과 연관 매핑의 장점만 취한 방식이다. 집합-연관 매핑은 캐시를 K개의 집합으로 나누고 각 집합에 직접 매핑을 사용한다. 따라서 같은 끝자리를 가진 캐시 메모리도 K개가 되기 때문에 직접 매핑의 자리다툼 문제가 완화된다. 또한 집합 내에서 직접 매핑을 사용하기 때문에 연관 매핑처럼 모든 캐시를 뒤지는 일 없이 바로 캐시 히트 여부를 알 수 있다.

![캐시 집합-연관 매핑](https://github.com/summer-root/OS-study/blob/main/NEH/CHAPTER%2008%20%EA%B0%80%EC%83%81%20%EB%A9%94%EB%AA%A8%EB%A6%AC%EC%9D%98%20%EA%B8%B0%EC%B4%88/%EC%82%AC%EC%A7%84%20%EC%B2%A8%EB%B6%80/%EC%BA%90%EC%8B%9C%20%EC%A7%91%ED%95%A9-%EC%97%B0%EA%B4%80%20%EB%A7%A4%ED%95%91.jpg)