# 컴퓨터 성능 향상 기술

CPU 내부 버스의 속도가 시스템 버스의 속도보다 빠르기 때문에 발생하는 속도 차이를 개선하기 위한 기술이다.

<br>



## 버퍼

### 버퍼의 개념

버퍼는 속도에 차이가 있는 두 장치 사이에서 그 차이를 완화하는 역할을 한다. 데이터 전송 속도가 느린 경우 데이터를 모았다가 한 번에 전송하면 속도를 개선할 수 있다. 이렇게 일정량의 데이터를 모아 옮김으로써 속도의 차이를 완화하는 장치가 버퍼이다.

<br>



### 스풀

스풀(SPOOL; Simultaneous Peripheral Operation On-Line)은 CPU와 입출력장치가 독립적으로 작동하도록 고안된 소프트웨어적인 버퍼이다. 대표적으로는 프린터에 사용되는 스풀러가 있다. 스풀러는 인쇄할 내용을 순차적으로 출력하는 소프트웨어로, 출력 명령을 내린 프로그램과 독립적으로 동작한다.

버퍼의 경우 어떤 프로그램이 사용하는 데이터든 버퍼가 차면 이동이 시작된다. 버퍼를 공유하는 것이다. 반면 스풀러는 한 인쇄물이 완료될 때까지 다른 인쇄물이 끼어들 수 없으므로 프로그램 간에 배타적이다.

<br>



### :pencil2: 하드웨어 안전 제거

버퍼를 사용하는 경우 버퍼가 다 채워질 때까지 저장장치 간에 데이터 전송이 지연된다. 이 타이밍에 하드웨어를 제거하는 경우 데이터가 제대로 저장되지 않을 수 있다. 이때 하드웨어 안전 제거 기능을 이용하면 버퍼에 있는 아직 옮겨지지 않은 데이터를 저장장치로 내보내고 저장장치의 전원을 차단하여 안전하게 제거할 수 있도록 한다. 유닉스의 경우 버퍼의 내용을 강제로 전송하는 명령어로 fflush를 사용한다.

<br>



## 캐시

### 캐시의 개념

캐시는 메모리와 CPU 간의 속도 차이를 완화하기 위해 메모리의 데이터를 미리 가져와 저장해 두는 임시 저장소이다. 필요한 데이터를 모아 한꺼번에 전달하는 버퍼의 일종으로 CPU가 앞으로 사용할 것으로 예상되는 데이터를 미리 가져오기(prefetch) 한다.

캐시는 CPU 안에 있으며 CPU 내부 버스의 속도로 작동한다. 따라서 느리게 작동하는 메모리와 빠르게 작동하는 CPU 사이에서 속도 차이를 완화한다. 

CPU는 메모리에 접근해야 할 경우 캐시에 먼저 방문하여 원하는 데이터가 있는지 찾아본다. 캐시에서 원하는 데이터를 찾은 경우 캐시 히트라고 하며 그 데이터를 바로 사용한다. 원하는 데이터가 없는 경우 메모리로 가서 데이터를 찾는데 이를 캐시 미스라고 한다. 캐시 히트가 되는 비율을 캐시 적중률이라고 하며, 일반적인 컴퓨터의 캐시 적중률은 약 90%이다.

컴퓨터의 성능을 향상하려면 캐시 적중률이 높아야 하고, 캐시 적중률을 높이는 방법 중 하나는 캐시의 크기를 늘리는 것이다. 캐시의 크기가 커지면 더 많은 데이터를 미리 가져올 수 있어 캐시 적중률이 올라간다. 

캐시 적중률을 높이는 또 다른 방법은 앞으로 많이 사용될 데이터를 가져오는 것이다. 이와 관련된 이론으로는 현재 위치에 가까운 데이터가 멀리 있는 데이터보다 사용될 확률이 더 높다는 지역성(locality) 이론이 있다. 지역성 이론에 따르면 goto 문을 사용하는 경우 미리 가져온 데이터가 쓸모없어지기 때문에 사용하지 않는 것이 좋다.

<br>



### 즉시 쓰기와 지연 쓰기

캐시에 있는 데이터가 변경되는 경우 이를 메모리에 반영하는 방식은 다음 두 가지가 있다.

- 즉시 쓰기 : 캐시에 있는 데이터가 변경되면 이를 즉시 메모리에 반영하는 방식이다. 메모리와의 빈번한 데이터 전송으로 인해 성능이 저하된다는 것이 단점이나, 항상 메모리에 정보가 최신으로 유지되기 때문에 갑작스러운 정전에도 데이터를 잃어버리지 않는 장점이 있다.
- 지연 쓰기 : 캐시에 있는 데이터가 변경되면 변경된 내용을 모아서 주기적으로 반영하는 방식으로 카피백이라고도 한다. 메모리와의 데이터 전송 횟수가 줄어 시스템의 성능을 향상할 수 있으나, 메모리와 캐시된 데이터 사이에 불일치가 발생할 수 있다는 단점이 있다.

