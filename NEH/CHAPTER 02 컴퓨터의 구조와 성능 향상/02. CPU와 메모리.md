# CPU와 메모리

## CPU의 구성과 동작

### CPU의 기본 구성

- 산술논리 연산장치 (Arithmetic and Logic Unit; ALU) : CPU에서 데이터를 연산하는 장치를 말한다. 데이터의 산술 연산과 논리 연산을 수행한다.
- 제어장치 (Control Unit) : CPU에서 작업을 지시하는 부분을 말한다.
- 레지스터 (register) : CPU 내에 데이터를 임시로 보관하는 곳을 말한다.

<br>



### CPU의 명령어 처리 과정

1. 레지스터로 데이터 로드
2. 산술논리 연산 장치로 연산 실행
3. 레지스터에 결과 저장
4. 레지스터에 저장된 결과값을 메모리로 이동

<br>



### 레지스터의 종류

- 데이터 레지스터 (DR) : 메모리에서 가져온 데이터를 임시로 보관할 때 사용한다. CPU에 있는 대부분의 레지스터가 데이터 레지스터이기 때문에 일반 레지스터 또는 범용 레지스터라고 부른다.
- 주소 레지스터 (AR) : 데이터 또는 명령어가 저장된 메모리의 주소가 저장되는 레지스터이다.
- 특수 레지스터 : 사용자가 임의로 변경할 수 없는 레지스터이다. 따라서 사용자 불가시 레지스터라고도 부른다.
  - 프로그램 카운터 (PC) : CPU가 다음에 처리할 명령을 알도록 하기 위해 다음 실행할 명령의 주소를 기억하고 있다가 제어장치에 알려주는 역할을 한다. 다음에 실행할 명령어의 주소를 가리키기 때문에 명령어 포인터라고도 한다.
  - 명령어 레지스터 (IR) : 현재 실행 중인 명령어를 저장한다.
  - 메모리 주소 레지스터 (MAR) : 메모리에서 데이터를 가져오거나 보낼 때 주소를 지정하기 위해 사용한다.
  - 메모리 버퍼 레지스터 (MBR) : 메모리에서 가져온 데이터나 메모리로 옮겨갈 데이터를 임시로 저장한다. 메모리 버퍼 레지스터는 항상 메모리 주소 레지스터와 함께 동작한다.
  - 프로그램 상태 레지스터 : 연산 결과가 양수인지 음수인지, 0이 아닌지 등을 저장한다. 플래그 레지스터, 상태 레지스터, 컨디션 레지스터라고도 부른다.

<br>



### 버스의 종류

- 제어 버스 : 다음에 어떤 작업을 할지 지시하는 제어 신호를 주고받는다. 메모리에서 데이터를 가져올 때는 읽기 신호를 보내고, 처리한 데이터를 메모리로 옮겨 놓을 때는 쓰기 신호를 보낸다. 제어버스의 신호는 CPU, 메모리, 주변장치와 양방향으로 오고간다.
- 주소 버스 : 메모리의 데이터를 읽거나 쓸 때 어느 위치에서 작업할 것인지를 알려주는 위치정보(주소)가 오고간다. 주소버스는 메모리 주소 레지스터와 연결되어 있으며 단방향이다. CPU에서 나가는 주소 정보는 있지만, CPU로 들어오는 주소 정보는 없다.
- 데이터 버스 : 데이터를 이동시키는 역할을 한다. 데이터 버스는 메모리 버퍼 레지스터와 연결되어 있으며 양방향이다.



버스의 대역폭은 한 번에 전달할 수 있는 데이터의 최대 크기이다. 버스의 대역폭, 레지스터의 크기, 메모리에 한 번에 저장할 수 있는 데이터의 크기는 항상 같다. CPU가 한 번에 처리할 수 있는 데이터의 최대 크기를 워드라고 하며, 버스의 대역폭과 메모리에 한 번에 저장되는 단위도 워드이다. 32bit CPU에서 1워드는 32bit이다.

<br>



## 메모리의 종류와 부팅

메모리 주소는 바이트 단위로 저장되고, 데이터를 읽거나 쓸 때는 워드 단위로 움직인다.

<br>



### 메모리의 종류

- 램 (RAM; Random Access Memory) : 읽거나 쓸 수 있는 메모리로 무작위로 데이터를 읽어도 저장된 위치와 관계 없이 같은 속도로 데이터를 읽을 수 있다.
  - 휘발성 메모리
    - DRAM (Dynamic RAM; 동적 램) : 저장된 데이터가 일정 시간이 지나면 사라지기 때문에 일정 시간마다 다시 재생시켜야 한다. 일반적으로 메인 메모리에 사용된다.
    - SRAM (Static RAM; 정적 램) : 전력이 공급되는 동안에는 데이터를 보관할 수 있어 재생할 필요가 없다. 따라서 속도는 빠르지만 가격이 비싸다. 일반적으로 캐시 같은 고속 메모리에 사용된다.
    - SDRAM (Synchronous Dynamic Random Access Memory) : DRAM이 발전된 형태로 클록틱이 발생할 때마다 데이터를 저장하는 동기 DRAM이다.
  - 비휘발성 메모리 : 전력이 끊겨도 데이터를 보관해야 하므로 메모리 내부가 복잡하고 속도가 느리며 가격이 비싸다.
    - 플래시 메모리 : 디지털 카메라, USB 등과 같이 전력이 없어도 데이터를 보관하는 저장장치로 많이 사용된다. 단, 플래시 메모리의 각 소자는 최대 사용 횟수가 제한되어 있어 해당 횟수 이상 사용하면 제 기능을 잃는다. 따라서 오래 사용하는 경우 성능이 저하되거나 데이터가 유실될 수 있다.
    - FRAM (Ferroelectric RAM)
    - PRAM (Phase change RAM)
    - SSD : 하드디스크를 대신하도록 만든 비휘발성 메모리로 가격이 비싸지만 접근 속도가 빠르다.
- 롬 (ROM; Read Only Memory) : 읽기만 가능한 메모리이다. 전력이 끊겨도 데이터를 보관하는 것이 장점이지만 데이터를 한 번 저장하면 바꿀 수 없다. 이러한 특성 때문에 바이오스를 롬에 저장한다.
  - 마스크롬 : 데이터를 지우거나 쓸 수 없다.
  - PROM (Programmable ROM) : 전용 기계를 이용하여 데이터를 한 번만 저장할 수 있다.
  - EPROM (Erasable Programmable ROM) : 데이터를 여러 번 쓰고 지울 수 있다. 플래시 메모리처럼 사용 가능하나, 가격이 비싸다.

<br>

#### :pencil2: DDR (Double Data Rate) SDRAM

CPU와의 속도 차이를 완화하기 위해 SDRAM의 대역폭을 늘려 데이터 입출력 속도를 빠르게 한 것이다. 기존의 SDRAM이 클록틱 한 번에 1개의 워드를 저장하는 반면, DDR SDRAM은 클록틱 한 번에 2개의 워드를 저장한다. 현재는 DDR4 SDRAM도 보급되고 있다.

<br>



### 메모리 보호

메모리 보호는 작업이 다른 작업 영역이나 운영 체제의 영역을 침범하지 않도록 하기 위해서 이루어져야 한다. 메모리를 보호하기 위해 CPU는 현재 진행 중인 작업의 메모리 시작 주소를 경계 레지스터에 저장한 후 작업을 한다. 또한 현재 진행 중인 작업이 차지하고 있는 메모리의 크기를 한계 레지스터에 저장한다. 그리고 작업이 진행되는 동안 이 두 레지스터의 범위를 벗어나는지 하드웨어적으로 점검하며 메모리를 보호한다.

만약 두 레지스터의 값을 벗어난가면 인터럽트가 발생하고, 인터럽트가 발생하면 모든 작업이 중단된다.

<br>



### 부팅

컴퓨터를 켰을 때 운영체제를 메모리에 올리는 과정을 부팅이라고 한다. 부팅 과정은 다음과 같다.

1. 사용자가 컴퓨터 전원을 켜면 롬에 저장된 바이오스가 실행된다.
2. 바이오스는 주요 하드웨어가 제대로 작동하는지 확인한다.
3. 이상이 없는 경우 하드디스크의 마스터 부트 레코드(MBR)에 저장된 프로그램을 메모리로 가져와 실행한다.
   마스터 부트 레코드는 하드디스크의 첫 번째 섹터를 가리키며, 운영체제를 실행하기 위한 코드인 부트스트랩이 이 곳에 저장되어 있다.
4. 부트스트랩이 메모리에 올라오면 하드디스크에 저장된 운영체제를 메모리로 불러온다.