# 요구 페이징

요구 페이징 : 프로세스(사용자)가 요청할 때 해당 모듈을 메모리로 가져오는 방법

<br>



## 요구 페이징의 개요

운영체제는 프로세스를 구성하는 모듈을 전부 메모리에 올리지 않고, 필요한 모듈만 메모리에 올려서 실행한다. 나머지 모듈은 필요하다고 판단될 때 메모리로 불러온다. 

프로세스의 일부만 메모리로 가져오는 이유는 다음과 같다.

- 메모리가 꽉 차면 관리하기 어렵기 때문에 가급적 적은 양의 프로세스만 유지하여 메모리를 효율적으로 관리하기 위함이다.
- 응답 속도 향상을 위함이다.

<br>



미리 가져오기는 요구 페이징과 반대로 앞으로 필요할 것이라고 예상되는 페이지를 미리 가져오는 방식이다. 대표적으로 캐시가 있다. 그러나 이 경우 미리 가져온 데이터가 쓸모없는 경우 피해가 매우 크다. 따라서 현대의 운영체제는 요구 페이징을 기본으로 사용한다.

<br>



### :pencil2: 스와핑과 게으른 스와퍼

프로세스를 구성하는 모든 페이지를 메모리에 올리는 것을 순수한 스와핑이라고 한다. 이와 달리 사용자가 요구할 때 메모리에 올리는 것을 게으른 스와퍼라고 한다.

<br>



## 페이지 테이블 엔트리의 구조

가상 메모리의 크기는 물리 메모리와 스왑 영역을 합친 것이다. 스왑 영역은 하드디스크에 존재하거나 메모리 관리자가 관리하는 영역으로 가상 메모리의 구성 요소 중 하나이다.

스왑 영역에서 물리 메모리로 데이터를 가져오는 것을 스왑인, 물리 메모리에서 스왑 영역으로 데이터를 내보내는 것을 스왑아웃이라고 한다.

<br>



페이지가 스왑 영역에 있는 경우

- 요구 페이징으로 인해 처음부터 물리 메모리에 올라가지 못한 경우
- 메모리가 꽉 차서 스왑 영역으로 옮겨 온 경우

페이지 테이블에는 페이지가 메모리에 있는지 스왑 영역에 있는지 표시해야 하는데 이때 사용하는 비트가 유효 비트이다.

<br>



다음은 페이지 테이블 엔트리(PTE)의 구성을 나타낸 것이다.

![페이지 테이블 엔트리의 구성](https://github.com/summer-root/OS-study/blob/main/NEH/CHAPTER%2009%20%EA%B0%80%EC%83%81%20%EB%A9%94%EB%AA%A8%EB%A6%AC%20%EA%B4%80%EB%A6%AC/%EC%82%AC%EC%A7%84%20%EC%B2%A8%EB%B6%80/%ED%8E%98%EC%9D%B4%EC%A7%80%20%ED%85%8C%EC%9D%B4%EB%B8%94%20%EC%97%94%ED%8A%B8%EB%A6%AC%EC%9D%98%20%EA%B5%AC%EC%84%B1.png)

PTE는 페이지 테이블의 한 행을 말한다. PTE는 페이지 번호, 플래그 비트, 프레임 번호로 구성된다. 몇몇 비트는 CPU에 따라 추가되거나 빠지기도 한다.

- 페이지 번호 :  매핑 방식에 따라 포함 여부가 결정된다.
- 프레임 번호 : 가상 주소의 해당 페이지가 어느 프레임에 있는지 알려 주는 자료 구조로 페이지 테이블의 핵심이다. 메모리 관리자는 찾은 프레임 번호를 이용하여 가상 주소를 물리 주소로 변환한다. 프레임 번호는 주소 필드라고도 한다. 
- 플래그 비트
  - 접근 비트 : 페이지가 메모리에 올라온 후 데이터의 변경이 있었는지 알려 주는 비트이다. 해당 메모리에 읽기나 실행 작업을 한 경우 접근 비트가 1이 된다. 참조 비트라고도 한다.
  - 변경 비트 : 페이지가 메모리에 올라온 후 데이터의 변경이 있었는지 알려 주는 비트이다.. 해당 메모리에 쓰거나 추가 작업을 한 경우 변경 비트가 1이 된다. 더티 비트라고도 한다.
  - 유효 비트 : 페이지가 실제 메모리에 있는지 나타내는 비트이다. 현재 비트라고도 한다.
  - 읽기, 쓰기, 실행 비트 : 페이지에 대한 읽기 권한, 쓰기 권한, 실행 권한을 나타내는 비트이다. 권한이 없는 경우 접근을 차단하기 위해 사용된다. 셋을 합쳐 접근 권한 비트라고도 부른다. 

<br>



## 페이지 부재

프로세스가 페이지를 요청했을 때 그 페이지가 메모리에 없는 상황을 페이지 부재라고 한다. 페이지 부재가 발생하면 프로세스가 해당 페이지를 사용할 수 있도록 스왑 영역에서 물리 메모리로 옮겨야 한다.

페이지 부재가 발생하면 스왑 영역에 있는 페이지를 메모리의 빈 영역에 올리고 페이지 테이블을 갱신한다. 메모리에 빈 프레임이 있는 경우에는 해당 프레임으로 옮기며 빈 프레임이 없을 떄는 메모리에 있는 프레임 중 하나를 스왑 영역으로 내보내야 한다. 

어떤 페이지를 스왑 영역으로 내보낼지 결정하는 알고리즘을 페이지 교체 알고리즘이라고 하며, 스왑 영역으로 보낼 페이지를 대상 페이지라고 한다.

<br>



세그먼테이션 오류 : 사용자의 프로세스가 주어진 메모리 공간을 벗어나거나 접근 권한이 없는 곳에 접근할 때 발생한다. 즉 사용자 프로세스에 의해 발생하며 해당 프로세스를 강제 종료하여 해결한다.

페이지 부재 : 해당 페이지가 물리 메모리에 없을 때 발생하는 오류로 사용자 프로세스와 무관하다.

<br>



## 지역성

페이지 교체 알고리즘이 쫓아낼 페이지를 찾을 때는 지역성을 바탕으로 한다. 지역성은 기억장치에 접근하는 패턴이 메모리 전체에 고루 분포되는 것이 아니라 특정 영역에 집중되는 성질을 말한다. 국부성 혹은 집약성이라고도 한다.

- 공간의 지역성 : 현재 위치에서 가까운 데이터에 접근할 확률이 먼 데이터에 접근할 확률보다 높다.
- 시간의 지역성 : 현재를 기준으로 가장 가까운 시간에 접근한 데이터가 더 먼 시간에 접근한 데이터보다 사용될 확률이 높다.
- 순차적 지역성 : 여러 작업이 순차적으로 진행되는 경향이 있다. 순차적 지역성을 공간의 지역성의 특별한 경우로 보기도 한다.

지역성을 사용하여 적게 사용할 페이지를 대상 페이지로 선정해 성능을 높인다. 

goto문을 사용하는 경우 엉뚱한 행으로 이동해 가져온 데이터가 쓸모없어질 수 있다. 따라서 goto문 사용은 성능에 좋지 않다.

