# 다중 프로그래밍 환경에서의 메모리 할당

## 메모리 분할 방식

메모리를 어떤 크기로 나눌 것인가는 메모리 배치 정책에 해당된다. 메모리 분할 방식은 다음 둘로 나뉜다.

- 가변 분할 방식 : 프로세스의 크기에 따라 메모리를 나눔
- 고정 분할 방식 : 프로세스의 크기와 상관없이 메모리를 같은 크기로 나눔

<br>



### 메모리 분할 방식의 구현

- 가변 분할 방식 : 프로세스의 크기에 맞게 메모리가 분할되므로 메모리의 영역이 각각 다르다. 한 프로세스가 연속된 공간에 배치되기 때문에 연속 메모리 할당이라고 한다.
  - 장점 : 하나의 프로세스를 연속된 공간에 배치한다.
  - 단점 : 하나의 프로세스가 종료될 때마다 메모리 통합 등의 부가적인 작업이 필요하므로 메모리 관리가 복잡하다.
- 고정 분할 방식 : 프로세스의 크기와 상관없이 메모리가 같은 크기로 나뉘며 큰 프로세스가 메모리에 올라오면 여러 조각으로 나뉘어 배치된다. 하나의 프로세스가 분산되어 배치되기 때문에 비연속 메모리 할당이라고 한다.
  - 장점 : 메모리를 일정한 크기로 나누어서 관리하기 때문에 메모리 관리가 수월하다. 메모리 통합 같은 부가적인 작업이 필요 없다.
  - 단점 : 나누어진 공간보다 작은 프로세스가 올라오는 경우 쓸모없는 공간으로 인해 메모리 낭비가 발생할 수 있다. 

<br>

현대 운영체제에서 메모리 관리는 기본적으로 고정 분할 방식을 사용하며, 일부분은 가변 분할 방식을 혼합하고 있다.

<br>



## 가변 분할 방식의 메모리 관리

가상 메모리 시스템에서는 가변 분할 방식을 세그먼테이션 기법이라고도 한다. 

<br>



### 프로세스 배치와 외부 단편화

가변 분할 방식은 빈 영역이 있어도 서로 떨어져 있으면 프로세스를 메모리에 올리지 못하는 문제점이 있다. 이로 인해 작은 조각들이 발생하는 현상을 단편화(조각화)라고 한다. 

가변 분할 방식에서 발생하는 빈 공간은 프로세스의 바깥쪽에서 발생하기 때문에 외부 단편화라고 한다. 외부 단편화로 인한 문제를 해결하기 위해 메모리 배치 방식이나 조각 모음을 사용한다.

<br>



### 메모리 배치 방식

작은 조각이 발생하지 않도록 프로세스를 배치하는 것으로 선처리에 해당한다.

- 최초 배치 : 단편화를 고려하지 않는 것으로 프로세스를 메모리의 빈 공간에 배치할 때 메모리에서 적재 가능한 공간을 순서대로 찾아 첫 번째로 발견한 공간에 프로세스를 배치하는 방법이다. 따라서 빈 공간을 찾아다닐 필요가 없다.
- 최적 배치 : 메모리의 빈 공간을 모두 확인한 후 적당한 크기 가운데 가장 작은 공간에 프로세스를 배치하는 방법이다. 따라서 빈 공간을 모두 확인하는 작업이 필요하지만 딱 맞는 공간을 찾는 경우 단편화가 일어나지 않는다. 하지만 딱 맞는 공간이 없는 경우에는 아주 작은 조각을 만들게 된다. 이런 공간은 매우 작아 버려질 가능성이 크다.
- 최악 배치: 최적 배치와 정반대로 빈 공간을 모두 확인한 후 가장 큰 공간에 프로세스를 배치하는 방법이다. 프로세스를 배치하고 남는 공간이 커 다른 프로세스를 배치할 수 있다. 하지만 빈 공간의 크기가 줄어들면 최적 배치처럼 작은 조각을 만들어낸다.

<br>



### 조각 모음

조각이 발생했을 때 작은 조각들을 모아서 하나의 큰 덩어리로 만드는 작업으로 후처리에 해당한다. 

메모리 배치 방식을 이용해도 단편화 현상은 발생한다. 가변 분할 방식의 목적은 프로세스를 한 덩어리로 취급하여 메모리 관리의 효율성을 높이는 것인데, 메모리 배치 방식으로는 근본적인 문제를 해결할 수 없다. 따러서 조각 모음을 진행한다.

조각 모음은 다음과 같은 순서로 진행된다.

1. 조각 모음을 하기 위해 이동할 프로세스의 동작을 멈춘다.

2. 프로세스를 적당한 위치로 이동한다. 프로세스가 이동하기 때문에 상대 주소값을 바꾼다.

3. 작업을 마친 후 프로세스를 다시 시작한다.

   

조각 모음은 시간이 오래 걸린다. 이처럼 가변 분할 방식은 부가적인 작업이 필요하므로 메모리 관리가 복잡하다.

<br>



#### :pencil2: 하드디스크의 조각 모음

외부 단편화는 하드디스크와 같은 저장장치에서도 발생한다. 데이터의 삭제와 저장을 반복하며 데이터가 여러 공간에 나뉘어 저장되는데, 이러한 현상이 지속되면 하드디스크의 데이터 입출력 속도를 떨어트려 컴퓨터의 성능이 저하된다. 따라서 저장장치도 성능을 유지하려면 주기적으로 조각 모음을 실행해야 한다.

<br>



## 고정 분할 방식의 메모리 관리

가상 메모리 시스템에서는 고정 분할 방식을 페이징이라고도 한다.

<br>



### 프로세스 배치와 내부 단편화

고정 분할 방식은 가변 분할 방식처럼 조각 모음을 할 필요가 없어 관리가 수월하기 때문에 현대의 메모리 시스템은 고정 분할 방식을 기본으로 사용한다.

<br>



### 내부 단편화

고정 분할 방식에서는 일정하게 나뉜 메모리의 크기보다 작은 프로세스가 배치될 경우 낭비되는 공간이 생긴다. 파티션 안쪽으로 조각이 발생하기 때문에 내부 단편화라고 한다. 

외부 단편화의 경우 조각 모음으로 조정했으나, 내부 단편화는 조각 모음을 할 수 없고 남는 공간을 다른 프로세스에 배정할 수도 없다. 대신 동일하게 분할되는 공간의 크기를 조절하여 내부 단편화를 최소화한다. 따라서 신중하게 메모리의 크기를 결정해 자주어야 한다. 

<br>



## 버디 시스템

가변 분할 방식의 단점인 외부 단편화를 완화하는 방법이다. 

<br>



### 버디 시스템의 작동 방식

가변 분할 방식과 고정 분할 방식의 중간 구조인 특징을 가지고 있다. 작동 방식은 다음과 같다.

1. 프로세스의 크기에 맞게 메모리를 1/2로 자르고 프로세스를 메모리에 배치한다.
2. 나뉜 메모리의 각 구역에는 프로세스가 1개만 들어간다.
3. 프로세스가 종료되면 주변의 빈 조각과 합쳐 하나의 큰 덩어리를 만든다.

<br>



### 버디 시스템의 특징

버디 시스템은 가변 분할 방식과 고정 분할 방식의 특징을 모두 가지고 있다. 가변 분할 방식처럼 메모리가 프로세스 크기대로 나뉘며, 고정 분할 방식처럼 하나의 구역에 다른 프로세스가 들어갈 수 없고, 메모리의 한 구역 내부에 조각이 생겨 내부 단편화가 발생한다.

버디 시스템이 효과적으로 공간을 관리할 수 있는 이유는 비슷한 크기의 덩어리가 서로 모여 있어 통합하기 쉽기 때문이다. 

고정 분할 방식과 버디 시스템은 효율적인 공간 관리 측면에서는 비슷한 수준이지만, 고정 분할 시스템이 메모리 관리 측면에서 더 단순하다.