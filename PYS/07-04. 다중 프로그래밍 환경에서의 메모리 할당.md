# 04 다중 프로그래밍 환경에서의 메모리 할당
- 한 번에 여러 프로세스를 동시에 실행하는 경우, 프로세스들의 크기가 달라 __메모리를 어떻게 나누어 사용할 것인지__ 가 가장 큰 문제

## 1 메모리 분할 방식
- 메모리를 어떤 크기로 나눌 것인가는 __메모리 배치 정책__ 에 해당됨

### 1.1 가변 분할 방식과 고정 분할 방식
- 메모리에 여러 개의 프로세스를 배치하는 두 가지 방법
1. 가변 분할 방식 (variable-size partitioning)
    - 프로세스의 크기에 맞게 메모리가 분할되므로 메모리의 영역이 각각 다름
    - 한 프로세스가 연속된 공간에 배치되기 때문에 연속 메모리 할당 (contiguous memory allocation) 이라고 함
    - 장점
        - 프로세스를 한 덩어리로 처리하여 하나의 프로세스를 연속된 공간에 배치
    - 단점
        - 메모리 통합 등의 부가적인 작업이 필요하므로 메모리 관리가 복잡함
2. 고정 분할 방식 (fixed-size partitioning)
    - 프로세스의 크기에 상관없이 메모리를 같은 크기로 나눔
    - 큰 프로세스가 메모리에 올라오면 여러 조각으로 나누어 배치
    - 한 프로세스가 분산되어 배치되기 떄문에 비연속 메모리 할당 (noncontiguous memeory allocation) 이라고 함
    - 장점
        - 메모리 관리가 수월함 (메모리 통합 같은 부가적인 작업이 필요하지 않음)
    - 단점
        - 일정하게 나누어진 공간보다 작은 프로세스가 올라올 경우 메모리 낭비가 발생함
- 현대 운영체제에서 메모리 관리는 기본적으로 고정 분할 방식을 사용, 일부분은 가변 분할 방식을 혼합함

## 2 가변 분할 방식의 메모리 관리
- 가상 메모리 시스템에서는 가변 분할 방식을 세그먼테이션 기법이라고도 함

### 2.1 프로세스 배치와 외부 단편화
- 가변 분할 방식을 사용하면 빈 영역이 있어도 서로 떨어져 있으면 프로세스를 배정하지 못함
- 이로 인해 작은 조각들이 발생하는 현상을 단편화 (fragmentation) 또는 조각화라고 함
- 가변 분할 방식에서 발생하는 작은 빈 공간을 외부 단편화 (external fragmentation) 라고 함 (프로세스의 바깥쪽에 조각이 발생하기 때문)
- 외부 단편화로 인한 문제를 해결하기 위한 방법
    1. 메모리 배치 방식 (memory placement strategy)
        - 작은 조각이 발생하지 않도록 프로세스를 배치하는 것 (선처리)
    2. 조각 모음 (defragmentation)
        - 조각이 발생했을 때 작은 조각들을 모아서 하나의 큰 덩어리로 만드는 작업 (후처리)

### 2.2 메모리 배치 방식
- 최초 배치 (first fit)
    - 단편화를 고려하지 않는 것
    - 프로세스를 메모리의 빈 공간에 배치할 때 메모리에서 적재 가능한 공간을 찾다가 첫 번째로 발견한 공간에 프로세스를 배치하는 방법
- 최적 배치 (best fit)
    - 메모리의 빈 공간을 모두 확인한 후 적당한 크기 가운데 가장 작은 공간에 프로세스를 배치하는 방법
    - 딱 맞는 공간을 찾을 경우 단편화가 일어나지 않지만, 그렇지 않을 경우 아주 작은 조각을 만들어내는 단점이 있음
- 최악 배치 (worst fit)
    - 빈 공간을 모두 확인한 후 가장 큰 공간에 프로세스를 배치하는 방법
    - 빈 공간의 크기가 클 때는 효과적이지만 빈 공간의 크기가 점점 줄어들면 최적 배치처럼 작은 조각을 만듦
- 버디 시스템

### 2.3 조각 모음
- 단편화가 발생했을 때 이미 배치된 프로세스를 옆으로 옮겨 빈 공간을 하나의 큰 덩어리로 만드는 것
- 서로 떨어져 있는 여러 개의 빈 공간을 합치는 작업
- 조각 모음 진행 순서
    1. 조각 모음을 하기 위해 이동할 프로세스의 동작을 멈춤
    2. 프로세스를 적당한 위치로 옮김, 프로세스가 원래의 위치에서 이동하기 때문에 프로세스의 상대 주소값을 바꿈
    3. 이러한 작업을 다 마친 후 프로세스를 다시 시작함