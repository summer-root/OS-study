# 01 요구 페이징
- 프로세스가 필요로 하는 데이터를 언제 메모리로 가져올지 결정하는 것은 __가져오기 정책__

## 1 요구 페이징의 개요
- 컴퓨터를 오래 켜놨을 때 시스템이 느려지는 이유는 작업을 하지 않고 쉬는 프로세스나 좀비 프로세스가 메모리를 차지하여 메모리 관리가 복잡해지기 때문
    - 좀비 프로세스
- 따라서 메모리에는 꼭 필요한 프로세스만 유지하는 것이 좋음
- 용량이 큰 프로세스를 실행할 때 운영체제는 프로세스를 구성하는 모든 모듈을 메모리에 올리지 않고, __필요한 모듈만 메모리에 올려 실행하고 나머지 모듈은 필요하다고 판단될 때 메모리로 불러옴__
    - 메모리를 효율적으로 관리하기 위해서 (메모리가 꽉 차면 관리하기 어려우므로 가급적 적은 양의 프로세스만 유지)
    - 응답 속도를 향상하기 위해서
- __요구 페이징__ : 사용자가 요구할 때 해당 페이지를 메모리로 가져오는 방식
- __미리 가져오기__ : 요구 페이징과 반대로 앞으로 필요할 것이라고 예상되는 페이지를 미리 가져오는 방식 (ex. 캐시)
    - 미리 가져온 데이터가 쓸모없을 경우 피해가 매우 크기 때문에 현대의 운영체제는 요구 페이징을 기본으로 사용함
- 스와핑(swapping): 프로세스를 구성하는 모든 페이지를 메모리에 올리는 것
- 게으른 스와퍼(lazy swapper): 사용자가 요구할 때 메모리에 올리는 것

## 2 페이지 테이블 엔트리의 구조
- 가상 메모리의 크기는 물리 메모리와 스왑 영역을 합친 것
- 스왑 영역: 하드디스크에 존재하나 메모리 관리자가 관리하는 영역으로, 가상 메모리의 구성 요소 중 하나
    - 스왑인: 스왑 영역에서 물리 메모리로 데이터를 가져오는 것
    - 스왑아웃: 물리 메모리에서 스왑 영역으로 데이터를 내보내는 것
- 가상 메모리 시스템에서 사용자의 프로세스는 물리 메모리와 스왑 영역 중 한 곳에 있음
    - 페이지가 스왑 영역에 있는 경우 두 가지
        1. 요구 페이징으로 인해 처음부터 물리 메모리에 올라가지 못한 경우
        2. 메모리가 꽉 차서 스왑 영역으로 옮겨 온 경우
    - 페이지 테이블에는 __유효 비트__ 를 사용해 페이지가 메모리에 있는지, 스왑 영역에 있는지 표시함
- 페이지 테이블 엔트리(PTE)는 페이지 테이블의 한 행을 말함
    - PTE는 __페이지 번호, 플래그 비트, 프레임 번호__ 로 구성됨
    - 프레임 번호(주소 필드, address field)는 가상 주소의 해당 페이지가 어느 프레임에 있는지 알려주는 자료 구조로, 페이지 테이블의 핵심
    - 플래그 비트
        1. 접근 비트(참조 비트): 페이지가 메모리에 올라온 후 사용한 적이 있는지 알려주는 비트
        2. 변경 비트(더티 비트): 페이지가 메모리에 올라온 후 데이터의 변경이 있었는지 알려주는 비트
        3. 유효 비트(현재 비트): 페이지가 실제 메모리에 있는지를 나타내는 비트
        4. 읽기, 쓰기, 실행 비트 (접근 권한 비트): 페이지에 대한 읽기, 쓰기, 실행 권한을 나타내는 비트
        - 접근 비트와 변경 비트는 페이지가 메모리에 올라온 후 어떤 작업이 있었는지 알려주는 역할을 하고, 메모리가 꽉 차서 어떤 페이지를 스왑 영역으로 옮겨야 할지 선택할 때 사용함
    
## 3 페이지 부재
- 유효 비트 0 : 페이지가 메모리에 있음 (주소 필드에 물리 메모리의 프레임 번호가 저장됨)
- 유효 비트 1 : 페이지가 스왑 영역에 있음 (주소 필드에 스왑 영역 내 페이지의 주소가 저장됨)
- __페이지 부재__ (page fault) : 프로세스가 페이지를 요청했을 때 그 페이지가 메모리에 없는 상황  
    - 페이지 부재가 발생하면 프로세스가 페이지를 사용할 수 있도록 스왑 영역에 있는 페이지를 메모리의 빈 영역에 올리고 페이지 테이블을 갱신(업데이트)함
    - 빈 프레임이 없을 때는 메모리에 있는 프레임 중 하나를 스왑 영역으로 내보낸 후에 페이지를 가져올 수 있음
    - 페이지 교체 알고리즘 : 어떤 페이지를 스왑 영역으로 내보낼지 결정하는 알고리즘
    - 대상 페이지 (victim page) : 페이지 교체 알고리즘에 의해 스왑 영역으로 보낼 페이지
- 세그먼테이션 오류와 페이지 부재의 차이
    - 세그먼테이션 오류는 사용자의 프로세스가 주어진 메모리 공간을 벗어나거나 접근 권한이 없는 곳에 접근할 때 발생  
    사용자 프로세스에 의해 발생하며 해당 프로세스를 강제 종료하여 해결
    - 페이지 부재는 해당 페이지가 물리 메모리에 없을 때 발생하는 오류로 사용자 프로세스와 무관

## 4 지역성
- 메모리가 꽉 차서 어떤 페이지를 스왑 영역으로 보낼 때는 되도록 앞으로 사용하지 않을 페이지를 쫓아내는 것이 좋음
- __지역성__ (locality) : 기억장치에 접근하는 패턴이 메모리 전체에 고루 분포되는 것이 아니라 특정 영역에 집중되는 성질
    - 페이지 교체 알고리즘이 쫓아낼 페이지를 찾을 때 지역성을 바탕으로 함
    - 공간의 지역성: 현재 위치에서 가까운 데이터에 접근할 확률이 먼 거리에 있는 데이터에 접근할 확률보다 높다
    - 시간의 지역성: 현재를 기준으로 가장 가까운 시간에 접근한 데이터가 더 먼 시간에 접근한 데이터보다 사용될 확률이 높다
    - 순차적 지역성: 여러 작업이 순서대로 진행되는 경향이 있다
- 캐시는 지역성 이론을 사용하는 대표적인 장치
    - 시간적, 지역적으로 가까이 있는 데이터를 가져옴으로써 캐시 적중률을 높일 수 있음