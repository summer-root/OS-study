# 03 프로세스의 연산
## 1 프로세스의 구조
- 코드 영역: 프로그램의 본문이 기술된 곳으로 텍스트 영역이라고도 함, 탑재된 코드는 읽기 전용으로 처리됨
- 데이터 영역: 코드가 실행되면서 사용하는 변수나 파일 등의 각종 데이터를 모아놓은 곳, 데이터는 변하는 값이기 때문에 데이터 영역은 기본적으로 읽기와 쓰기가 가능함
- 스택 영역: 운영체제가 프로세스를 실행하기 위해 부수적으로 필요한 데이터를 모아놓은 곳, 스택 영역은 운영체제가 사용자의 프로세스를 작동하기 위해 유지하는 영역이므로 사용자에게는 보이지 않음

## 2 프로세스의 생성과 복사
- 사용자가 프로그램을 실행하면 운영체제는 프로그램을 메모리로 가져와 코드 영역에 넣고 PCB를 생성하고, 메모리에 데이터 영역과 스택 영역을 확보한 후 프로세스를 실행함

### 2.1 fork() 시스템 호출의 개념
- fork() 시스템 호출은 실행 중인 프로세스로부터 새로운 프로세스를 복사하는 함수로, 커널에서 제공
- 프로세스를 복사할 때 기존의 프로세스는 부모 프로세스가 되고 새로 생긴 프로세스는 자식 프로세스가 되며, 두 프로세스는 부모-자식 관계로 연결됨

### 2.2 fork() 시스템 호출의 동작 과정
- fork() 시스템 호출을 하면 PCB를 포함한 부모 프로세스 영역의 대부분이 자식 프로세스에 복사되어 똑같은 프로세스가 만들어짐
- PCB의 내용 중 변경되는 부분
    - 프로세스 구분자(PID)
    - 메모리 관련 정보 (부모 프로세스와 자식 프로세스가 차지하고 있는 메모리의 위치가 다르므로)
    - 부모 프로세스 구분자(PPID)와 자식 프로세스 구분자(CPID) (자식 프로세스가 없는 경우 CPID의 값이 -1임)

### 2.3 fork() 시스템 호출의 장점
- 프로세스의 생성 속도가 빠르다
- 추가 작업 없이 자원을 상속할 수 있다
- 시스템 관리를 효율적으로 할 수 있다
    - 프로세스를 종료하면 프로세스가 사용하던 메모리 영역, 파일, 하드웨어를 잘 정리해야 함
    - 자식 프로세스를 종료했을 때 자식이 사용하던 자원의 정리를 부모 프로세스에 맡길 수 있어 시스템이 효율적으로 관리됨 (부모 프로세스와 자식 프로세스가 CPID와 PPID로 연결되어 있기 때문)

## 3 프로세스의 전환
### 3.1 exec() 시스템 호출의 개념
- fork(): 새로운 프로세스를 복사하는 시스템 호출
- exec(): 프로세스는 그대로 둔 채 내용만 바꾸는 시스템 호출, exec() 시스템 호출을 하면 현재의 프로세스가 완전히 다른 프로세스로 전환됨
    - exec() 시스템 호출을 사용하는 목적은 프로세스의 구조체를 재활용하기 위함
    - 이미 만들어진 PCB, 메모리 영역, 부모-자식 관계를 그대로 사용할 수 있어 편리하고, 새로운 코드 영역만 가져오면 되기 때문에 운영체제의 작업이 수월함

### 3.2 exec() 시스템 호출의 동작 과정
- 프로세스를 처음 시작하는 것처럼 내용이 정리됨
    - 코드 영역에 있는 기존의 내용을 지우고 새로운 코드로 바꿈
    - 데이터 영역이 새로운 변수로 채워지고 스택 영역이 리셋됨
    - PCB의 내용 중 PID, PPID, CPID, 메모리 관련 사항 등은 변하지 않지만 프로그램 카운터 레지스터 값을 비롯한 각종 레지스터와 사용한 파일 정보가 모두 리셋됨

## 4 프로세스의 계층 구조
### 4.2 프로세스 계층 구조의 장점
- 여러 작업의 동시 처리
    - fork() 시스템 호출로 같은 프로세스를 여러 개 만들어 여러 작업의 동시 처리가 가능해짐
- 용이한 자원 회수
    - 프로세스를 계층 구조로 만들면 프로세스 간의 책임 관계가 분명해져서 시스템을 관리하기가 수월함
    - 모든 프로세스가 독립적으로 만들어지면 프로세스가 종료될 때마다 운영체제가 직접 자원을 회수해야 하지만, 모든 프로세스를 부모-자식 관계로 만들면 자식 프로세스가 작업을 마쳤을 때 사용하던 자원을 부모 프로세스가 회수하면 됨

### 4.3 미아 프로세스
- 프로세스가 종료된 후에도 비정상적으로 남아 있는 프로세스를 미아 프로세스 또는 좀비 프로세스라고 함
- 컴퓨터에 미아 프로세스가 많아지면 자원이 낭비됨으로써 효율적인 운영에 방해가 되므로 운영체제는 반환되지 못한 자원을 회수하는 작업을 주기적으로 해야 함