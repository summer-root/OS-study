# 02 프로세스 제어 블록과 문맥 교환
## 1 프로세스 제어 블록 (PCB)
- 프로세스를 실행하는 데 필요한 중요한 정보를 보관하는 자료 구조로, TCB(Task Control Block)라고도 함
- 모든 프로세스는 고유의 PCB를 가지며, PCB는 프로세스 생성 시 만들어져서 프로세스가 실행을 완료하면 폐기됨

### 1.1 프로세스 제어 블록의 구성
- 포인터
    - PCB의 첫 번째 블록에 저장되며, PCB를 연결하여 준비 상태나 대기 상태의 큐를 구현할 때 포인터를 사용함
- 프로세스 상태
    - PCB의 두 번째 블록에 저장되며, 프로세스가 현재 어떤 상태(생성, 준비, 실행, 대기, 보류 준비, 보류 대기 등)에 있는지를 나타냄
- 프로세스 구분자
    - 운영체제 내에 있는 여러 프로세스를 구별하기 위한 구분자를 저장함
- 프로그램 카운터
    - 다음에 실행될 명령어의 위치를 가리키는 프로그램 카운터의 값을 저장함
- 프로세스 우선순위
    - 큐는 우선순위별로 따로 운영되며, CPU 스케줄러가 준비 상태에 있는 프로세스 중 실행 상태로 옮겨야 할 프로세스를 선택할 때는 프로세스 우선순위를 기준으로 삼음
    - 높은 우선순위의 프로세스가 낮은 우선순위의 프로세스보다 먼저 실행되고 더 자주 실행됨
- 각종 레지스터 정보
    - 다음에 실행할 때 사용하기 위해 이전에 실행할 때 자신이 사용한 레지스터의 중간값을 보관함
- 메모리 관리 정보
    - 프로세스가 메모리의 어디에 있는지 나타내는 메모리 위치 정보, 메모리 보호를 위해 사용하는 경계 레지스터 값과 한계 레지스터 값, 세그먼테이션 테이블, 페이지 테이블 등의 정보가 저장됨
- 할당된 자원 정보
    - 프로세스를 실행하기 위해 사용하는 입출력 자원이나 오픈 파일 등에 대한 정보
- 계정 정보
- 부모 프로세스 구분자(PPID)와 자식 프로세스 구분자(CPID)

### 1.2 포인터의 역할
- 인터럽트가 발생했을 때 해당 프로세스를 찾기 위해 대기 상태의 모든 프로세스를 뒤져야 하는 불편함이 없도록, 대기 상태에는 같은 입출력을 요구한 프로세스끼리 모아놓음 (대기 큐)
- 완료 인터럽트가 도착하면 해당 대기 큐에 있는 PCB를 찾아서 상태를 준비 상태로 바꾼 후 대기 큐에서 제거한 후 준비 큐로 이동함

## 2 문맥 교환
### 2.1 문맥 교환(context switching)의 의미
- 문맥 교환은 CPU를 차지하던 프로세스가 나가고 새로운 프로세스를 받아들이는 작업을 말함
- 두 프로세스의 PCB를 교환하는 작업
- 두 PCB의 내용이 변경되는데, 실행 상태에서 나가는 PCB에는 지금까지의 작업 내용을 저장하고, 실행 상태로 들어오는 PCB의 내용으로 CPU가 다시 세팅됨 (이전 작업 상태가 되어야 다음 작업이 가능하기 때문)

### 2.2 문맥 교환의 절차
- 실행 상태에 있는 프로세스 P1이 타임아웃이 되면 P1의 PCB에 현재까지의 작업 결과가 저장되고 P1은 준비 상태로 쫓겨남
- 준비 상태에 있던 프로세스 P2가 실행 상태로 가면 CPU의 레지스터가 P2의 PCB 값으로 채워져 다응 작업을 하게 됨
- 문맥 교환이 일어나는 다양한 경우
    - 타임아웃
    - 인터럽트: 예시) 프로세스가 경계 레지스터의 범위를 벗어나면 인터럽트가 발생하여 현재 실행 중인 프로세스의 제어 블록을 저장한 후 인터럽트 관리 프로세스를 실행 상태로 만듦(= 문맥 교환 발생), 인터럽트 관리 프로세스는 메모리 범위를 넘어선 프로세스를 강제로 종료하고 인터럽트 처리를 마침